<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    ztree
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://fastly.jsdelivr.net">
<meta name="author" content="ztree">
<meta name="description" content="ç«¹æ–èŠ’é‹è½»èƒœé©¬ï¼Œè°æ€•ï¼Ÿä¸€è“‘çƒŸé›¨ä»»å¹³ç”Ÿã€‚">
<meta name="keywords" content="Binary">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://lzxzl.github.io/styles/main.css" />
<link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
    
            <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                        <!--CDNæ ·å¼-->
                        <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://lzxzl.github.io">
                    ztree
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        å½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        å…³äº
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1747748455692" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://lzxzl.github.io">
                            ztree
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1747748455692" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            å½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            å…³äº
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                [ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part 12.
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            ztree
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2021-12-06</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">12.7
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">2629</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://lzxzl.github.io/tag/GqQg6_YXk/">ç¼–è¯‘åŸç†</a>
                                
                            </span>
                                            
                                                é˜…è¯»é‡:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                        <div class="post-content">
                            <blockquote>
<p><em>â€œBe not afraid of going slowly; be afraid only of standing still.â€ - ChineseÂ proverb.</em></p>
<p>â€œä¸æ€•æ…¢ï¼Œåªæ€•åŸåœ°è¸æ­¥â€â€”â€”ä¸­å›½è°šè¯­ã€‚</p>
</blockquote>
<p>Hello, and welcomeÂ back!</p>
<p>å¤§å®¶å¥½ï¼Œæ¬¢è¿å›æ¥ï¼</p>
<p>Today we are going to take a few more baby steps and learn how to parse Pascal procedureÂ declarations.</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†èµ°æ›´å¤šçš„baby stepï¼Œå¹¶å­¦ä¹ å¦‚ä½•è§£æ Pascal è¿‡ç¨‹å£°æ˜ï¼ˆprocedureÂ declarationsï¼‰ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://ruslanspivak.com/lsbasi-part12/lsbasi_part12_babysteps.png" alt="" loading="lazy"></figure>
<p>What is a <em><strong>procedure declaration</strong></em>? A <em><strong>procedure declaration</strong></em> is a language construct that defines an identifier (a procedure name) and associates it with a block of PascalÂ code.</p>
<p><strong>ä»€ä¹ˆæ˜¯è¿‡ç¨‹å£°æ˜ï¼Ÿè¿‡ç¨‹å£°æ˜æ˜¯ä¸€ç§è¯­è¨€ç»“æ„ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ ‡è¯†ç¬¦(è¿‡ç¨‹åç§°) ï¼Œå¹¶å°†å…¶ä¸ä¸€ç»„ Pascal ä»£ç å…³è”èµ·æ¥ã€‚</strong></p>
<p>Before we dive in, a few words about Pascal procedures and theirÂ declarations:</p>
<p>åœ¨æˆ‘ä»¬æ·±å…¥è®¨è®ºä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Pascal çš„proceduresåŠå…¶å£°æ˜:</p>
<ul>
<li>Pascal procedures donâ€™t have return statements. They exit when they reach the end of their correspondingÂ block. Pascal
<ul>
<li>è¿‡ç¨‹æ²¡æœ‰è¿”å›è¯­å¥ï¼Œå®ƒä»¬åœ¨åˆ°è¾¾ç›¸åº”å—çš„æœ«å°¾æ—¶é€€å‡º</li>
</ul>
</li>
<li>Pascal procedures can be nested within eachÂ other. Pascal
<ul>
<li>è¿‡ç¨‹å¯ä»¥ç›¸äº’åµŒå¥—</li>
</ul>
</li>
<li>For simplicity reasons, procedure declarations in this article wonâ€™t have any formal parameters. But, donâ€™t worry, weâ€™ll cover that later in theÂ series.
<ul>
<li>ä¸ºäº†ç®€å•èµ·è§ï¼Œæœ¬æ–‡ä¸­çš„è¿‡ç¨‹å£°æ˜æ²¡æœ‰ä»»ä½•å½¢å‚ã€‚ä½†æ˜¯ï¼Œä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—çš„åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<p>This is our test program forÂ today:</p>
<p>è¿™æ˜¯æˆ‘ä»¬ä»Šå¤©çš„æµ‹è¯•ç¨‹åº:</p>
<pre><code class="language-pascal">PROGRAM Part12;
VAR
   a : INTEGER;

PROCEDURE P1;
VAR
   a : REAL;
   k : INTEGER;

   PROCEDURE P2;
   VAR
      a, z : INTEGER;
   BEGIN {P2}
      z := 777;
   END;  {P2}

BEGIN {P1}

END;  {P1}

BEGIN {Part12}
   a := 10;
END.  {Part12}
</code></pre>
<p>As you can see above, we have defined two procedures (<em>P1</em> and <em>P2</em>) and <em>P2</em> is nested within <em>P1</em>. In the code above, I used comments with a procedureâ€™s name to clearly indicate where the body of every procedure begins and where itÂ ends.</p>
<p>æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸¤ä¸ªè¿‡ç¨‹(P1å’Œ P2) ï¼ŒP2åµŒå¥—åœ¨ P1ä¸­ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä½¿ç”¨å¸¦æœ‰è¿‡ç¨‹åç§°çš„æ³¨é‡Šæ¥æ¸…æ¥šåœ°æŒ‡å‡ºæ¯ä¸ªè¿‡ç¨‹çš„ä¸»ä½“å¼€å§‹å’Œç»“æŸçš„ä½ç½®ã€‚</p>
<p>Our objective for today is pretty clear: learn how to parse a code likeÂ that.</p>
<p>æˆ‘ä»¬ä»Šå¤©çš„ç›®æ ‡å¾ˆæ˜ç¡®: å­¦ä¹ å¦‚ä½•è§£æè¿™æ ·çš„ä»£ç ã€‚</p>
<p>First, we need to make some changes to our grammar to add procedure declarations. Well, letâ€™s just doÂ that!</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¹grammarè¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œä»¥æ·»åŠ è¿‡ç¨‹å£°æ˜ï¼</p>
<p>Here is the updated <em>declarations</em> grammarÂ rule:</p>
<p>ä¸‹é¢æ˜¯æ›´æ–°çš„ declarations grammarè§„åˆ™:</p>
<figure data-type="image" tabindex="2"><img src="https://ruslanspivak.com/lsbasi-part12/lsbasi_part12_grammar.png" alt="" loading="lazy"></figure>
<p>The procedure declaration sub-rule consists of the reserved keyword <strong>PROCEDURE</strong> followed by an identifier (a procedure name), followed by a semicolon, which in turn is followed by a <em>block</em> rule, which is terminated by a semicolon. Whoa! This is a case where I think the picture is actually worth however many words I just put in the previous sentence!Â ğŸ˜ƒ</p>
<p>è¿‡ç¨‹å£°æ˜å­è§„åˆ™åŒ…æ‹¬ä¿ç•™å…³é”®å­— PROCEDURE åè·Ÿæ ‡è¯†ç¬¦(è¿‡ç¨‹åç§°) ï¼Œåè·Ÿåˆ†å·ï¼Œåˆ†å·åè·Ÿblockè§„åˆ™ï¼Œä»¥åˆ†å·ç»“æŸã€‚å“‡ï¼åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®ºæˆ‘åœ¨å‰é¢çš„å¥å­ä¸­åŠ å…¥å¤šå°‘å­—ï¼Œæˆ‘éƒ½è®¤ä¸ºå›¾ç‰‡æ˜¯å€¼å¾—çš„ï¼ğŸ˜ƒ</p>
<p>Here is the updated syntax diagram for the <em>declarations</em>Â rule:</p>
<p>ä¸‹é¢æ˜¯æ›´æ–°åçš„declarationsè§„åˆ™è¯­æ³•å›¾:</p>
<figure data-type="image" tabindex="3"><img src="https://ruslanspivak.com/lsbasi-part12/lsbasi_part12_syntaxdiagram.png" alt="" loading="lazy"></figure>
<p>From the grammar and the diagram above you can see that you can have as many procedure declarations on the same level as you want. For example, in the code snippet below we define two procedure declarations, <em>P1</em> and <em>P1A</em>, on the sameÂ level:</p>
<p>ä»ä¸Šé¢çš„è¯­æ³•å’Œå›¾è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ‚¨å¯ä»¥åœ¨åŒä¸€çº§åˆ«ä¸Šæ‹¥æœ‰ä»»æ„å¤šçš„è¿‡ç¨‹å£°æ˜ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬åœ¨åŒä¸€çº§åˆ«å®šä¹‰äº†ä¸¤ä¸ªè¿‡ç¨‹å£°æ˜ï¼ŒP1å’Œ P1Aï¼š</p>
<pre><code class="language-pascal">PROGRAM Test;
VAR
   a : INTEGER;

PROCEDURE P1;
BEGIN {P1}

END;  {P1}

PROCEDURE P1A;
BEGIN {P1A}

END;  {P1A}

BEGIN {Test}
   a := 10;
END.  {Test}
</code></pre>
<p>The diagram and the grammar rule above also indicate that procedure declarations can be nested because the <em>procedure declaration</em> sub-rule references the <em>block</em> rule which contains the <em>declarations</em> rule, which in turn contains the <em>procedure declaration</em> sub-rule. As a reminder, here is the syntax diagram and the grammar for the block rule from <a href="https://ruslanspivak.com/lsbasi-part10/">Part10</a>:</p>
<p>ä¸Šé¢çš„å›¾å’Œè¯­æ³•è§„åˆ™ä¹Ÿè¡¨æ˜è¿‡ç¨‹declarationså¯ä»¥åµŒå¥—ï¼Œå› ä¸ºè¿‡ç¨‹declarationså­è§„åˆ™å¼•ç”¨äº†åŒ…å«declarationsè§„åˆ™çš„blockè§„åˆ™ï¼Œè€Œblockè§„åˆ™åˆåŒ…å«è¿‡ç¨‹declarationså­è§„åˆ™ã€‚æé†’ä¸€ä¸‹ï¼Œä¸‹é¢æ˜¯ç¬¬10éƒ¨åˆ†ä¸­blockè§„åˆ™çš„è¯­æ³•å›¾å’Œè¯­æ³•:</p>
<figure data-type="image" tabindex="4"><img src="https://ruslanspivak.com/lsbasi-part12/lsbasi_part12_block_rule_from_part10.png" alt="" loading="lazy"></figure>
<p>Okay, now letâ€™s focus on the interpreter components that need to be updated to support procedureÂ declarations:</p>
<p>å¥½çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹éœ€è¦æ›´æ–°ä»¥æ”¯æŒè¿‡ç¨‹å£°æ˜çš„è§£é‡Šå™¨ç»„ä»¶:</p>
<p><em><strong>Updating theÂ Lexer</strong></em></p>
<p>æ›´æ–° Lexer</p>
<p>All we need to do is add a new token named <strong>PROCEDURE</strong>:</p>
<p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯æ·»åŠ ä¸€ä¸ªåä¸º PROCEDURE çš„æ–°tokenï¼š</p>
<p>And add <em>â€˜PROCEDUREâ€™</em> to the reserved keywords. Here is the complete mapping of reserved keywords toÂ tokens:</p>
<p>ç„¶ååœ¨ä¿ç•™å…³é”®å­—ä¸Šæ·»åŠ â€˜ PROCEDUREâ€™ï¼Œè¿™é‡Œæ˜¯ä¿ç•™å…³é”®å­—åˆ°tokençš„å®Œæ•´æ˜ å°„:</p>
<pre><code class="language-python">RESERVED_KEYWORDS = {
    'PROGRAM': Token('PROGRAM', 'PROGRAM'),
    'VAR': Token('VAR', 'VAR'),
    'DIV': Token('INTEGER_DIV', 'DIV'),
    'INTEGER': Token('INTEGER', 'INTEGER'),
    'REAL': Token('REAL', 'REAL'),
    'BEGIN': Token('BEGIN', 'BEGIN'),
    'END': Token('END', 'END'),
    'PROCEDURE': Token('PROCEDURE', 'PROCEDURE'),
}
</code></pre>
<p><em><strong>Updating theÂ Parser</strong></em></p>
<p>æ›´æ–°è§£æå™¨</p>
<p>Here is a summary of the parserÂ changes:</p>
<p>ä¸‹é¢æ˜¯è§£æå™¨æ›´æ”¹çš„æ‘˜è¦:</p>
<ol>
<li>New _ProcedureDecl _ AST Â node</li>
</ol>
<p>æ–°çš„_ProcedureDecl AST _èŠ‚ç‚¹</p>
<ol start="2">
<li>Update to the parserâ€™s _declarations _method to support procedureÂ declarations</li>
</ol>
<p>æ›´æ–°è§£æå™¨çš„declarationsæ–¹æ³•æ¥æ”¯æŒè¿‡ç¨‹å£°æ˜</p>
<p>Letâ€™s go over theÂ changes.</p>
<p>æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹è¿™äº›æ”¹åŠ¨ã€‚</p>
<ol>
<li>The <em>ProcedureDecl</em> AST node represents a <em>procedure declaration</em>. The class constructor takes as parameters the name of the procedure and the AST node of the block of code that the procedureâ€™s name refersÂ to.<br>
<em>ProcedureDecl</em> AST èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªè¿‡ç¨‹å£°æ˜ã€‚ç±»æ„é€ å‡½æ•°æ¥å—procedureçš„åç§°å’Œprocedureåç§°å¼•ç”¨çš„ä»£ç å—çš„ AST èŠ‚ç‚¹ä½œä¸ºå‚æ•°ã€‚</li>
</ol>
<pre><code class="language-python">class ProcedureDecl(AST):
    def __init__(self, proc_name, block_node):
        self.proc_name = proc_name
        self.block_node = block_node
</code></pre>
<ol start="2">
<li>Here is the updated <em>declarations</em> method of the <em>Parser</em>Â class<br>
ä¸‹é¢æ˜¯ Parser ç±»çš„æ›´æ–°å£°æ˜æ–¹æ³•</li>
</ol>
<pre><code class="language-python">def declarations(self):
    &quot;&quot;&quot;declarations : VAR (variable_declaration SEMI)+
                    | (PROCEDURE ID SEMI block SEMI)*
                    | empty
    &quot;&quot;&quot;
    declarations = []

    if self.current_token.type == VAR:
        self.eat(VAR)
        while self.current_token.type == ID:
            var_decl = self.variable_declaration()
            declarations.extend(var_decl)
            self.eat(SEMI)

    while self.current_token.type == PROCEDURE:
        self.eat(PROCEDURE)
        proc_name = self.current_token.value
        self.eat(ID)
        self.eat(SEMI)
        block_node = self.block()
        proc_decl = ProcedureDecl(proc_name, block_node)
        declarations.append(proc_decl)
        self.eat(SEMI)

    return declarations
</code></pre>
<p>Hopefully, the code above is pretty self-explanatory. It follows the grammar/syntax diagram for procedure declarations that youâ€™ve seen earlier in theÂ article.<br>
å¸Œæœ›ä¸Šé¢çš„ä»£ç éå¸¸å®¹æ˜“ç†è§£ã€‚å®ƒéµå¾ªæ‚¨åœ¨æœ¬æ–‡å‰é¢çœ‹åˆ°çš„è¿‡ç¨‹å£°æ˜çš„è¯­æ³•/è¯­æ³•å›¾ã€‚</p>
<p><em><strong>Updating the SymbolTableÂ builder</strong></em></p>
<p>æ›´æ–° <em><strong>SymbolTable</strong></em> ç”Ÿæˆå™¨</p>
<p>Because weâ€™re not ready yet to handle nested procedure scopes, weâ€™ll simply add an empty <em>visit_ProcedureDecl</em> method to the <em>SymbolTreeBuilder</em> AST visitor class. Weâ€™ll fill it out in the nextÂ article.</p>
<p>å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å‡†å¤‡å¥½å¤„ç†åµŒå¥—çš„ procedure åŸŸï¼Œæˆ‘ä»¬åªéœ€è¦å‘_SymbolTreeBuilder AST visitorç±»æ·»åŠ ä¸€ä¸ªç©ºçš„_ _visit_ProcedureDecl _æ–¹æ³•ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å¡«å†™å®ƒã€‚</p>
<pre><code class="language-python">def visit_ProcedureDecl(self, node):
    pass
</code></pre>
<p><em><strong>Updating theÂ Interpreter</strong></em></p>
<p>æ›´æ–°è§£é‡Šå™¨</p>
<p>We also need to add an empty <em>visit_ProcedureDecl</em> method to the <em>Interpreter</em> class, which will cause our interpreter to silently ignore all our procedureÂ declarations.</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨ Interpreter ç±»ä¸­æ·»åŠ ä¸€ä¸ªç©ºçš„ <em>visit_ProcedureDecl</em> æ–¹æ³•ï¼Œè¿™å°†å¯¼è‡´æˆ‘ä»¬çš„è§£é‡Šå™¨é™é»˜åœ°å¿½ç•¥æ‰€æœ‰çš„è¿‡ç¨‹å£°æ˜ã€‚</p>
<p>So far, soÂ good.</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡é¡ºåˆ©ã€‚</p>
<p>Now that weâ€™ve made all the necessary changes, letâ€™s see what the <em>Abstract Syntax Tree</em> looks like with the new <em>ProcedureDecl</em>Â nodes.</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»åšäº†æ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä½¿ç”¨æ–°çš„ ProcedureDecl èŠ‚ç‚¹åçš„æŠ½è±¡è¯­æ³•æ ‘æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<p>Here is our Pascal program again (you can download it directly from <a href="https://github.com/rspivak/lsbasi/blob/master/part12/python/part12.pas">GitHub</a>):</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬çš„ Pascal ç¨‹åº(ä½ å¯ä»¥ç›´æ¥ä» GitHub ä¸‹è½½) :</p>
<pre><code class="language-pascal">PROGRAM Part12;
VAR
   a : INTEGER;

PROCEDURE P1;
VAR
   a : REAL;
   k : INTEGER;

   PROCEDURE P2;
   VAR
      a, z : INTEGER;
   BEGIN {P2}
      z := 777;
   END;  {P2}

BEGIN {P1}

END;  {P1}

BEGIN {Part12}
   a := 10;
END.  {Part12}
</code></pre>
<p>Letâ€™s generate an AST and visualize it with the <a href="https://github.com/rspivak/lsbasi/blob/master/part12/python/genastdot.py">genastdot.py</a>Â utility:</p>
<p>è®©æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª ASTï¼Œå¹¶ä½¿ç”¨ genastdot.py å®ç”¨ç¨‹åºå°†å…¶å¯è§†åŒ–:</p>
<pre><code class="language-shell">$ python genastdot.py part12.pas &gt; ast.dot &amp;&amp; dot -Tpng -o ast.png ast.dot
</code></pre>
<figure data-type="image" tabindex="5"><img src="https://ruslanspivak.com/lsbasi-part12/lsbasi_part12_procdecl_ast.png" alt="" loading="lazy"></figure>
<p>In the picture above you can see two <em>ProcedureDecl</em> nodes: <em>ProcDecl:P1</em> and <em>ProcDecl:P2</em> that correspond to procedures <em>P1</em> and <em>P2</em>. Mission accomplished.Â ğŸ˜ƒ</p>
<p>åœ¨ä¸Šé¢çš„å›¾ç‰‡ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ª ProcedureDecl èŠ‚ç‚¹: ProcDecl: P1å’Œ ProcDecl: P2ï¼Œå®ƒä»¬å¯¹åº”äºè¿‡ç¨‹ P1å’Œ P2ã€‚ä»»åŠ¡å®Œæˆã€‚ğŸ˜ƒ</p>
<p>As a last item for today, letâ€™s quickly check that our updated interpreter works as before when a Pascal program has procedure declarations in it. Download <a href="https://github.com/rspivak/lsbasi/blob/master/part12/python/spi.py">the interpreter</a> and <a href="https://github.com/rspivak/lsbasi/blob/master/part12/python/part12.pas">the test program</a> if you havenâ€™t done so yet, and run it on the command line. Your output should look similar toÂ this:</p>
<p>ä½œä¸ºä»Šå¤©çš„æœ€åä¸€é¡¹ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿæ£€æŸ¥ä¸€ä¸‹ï¼Œå½“ Pascal ç¨‹åºä¸­åŒ…å«è¿‡ç¨‹å£°æ˜æ—¶ï¼Œæˆ‘ä»¬æ›´æ–°çš„è§£é‡Šå™¨æ˜¯å¦åƒä»¥å‰ä¸€æ ·å·¥ä½œã€‚ä¸‹è½½è§£é‡Šå™¨å’Œæµ‹è¯•ç¨‹åº(å¦‚æœæ‚¨è¿˜æ²¡æœ‰è¿™æ ·åšçš„è¯) ï¼Œå¹¶åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œå®ƒã€‚ä½ çš„è¾“å‡ºåº”è¯¥ç±»ä¼¼äºè¿™æ ·:</p>
<pre><code class="language-shell">$ python spi.py part12.pas
Define: INTEGER
Define: REAL
Lookup: INTEGER
Define: &lt;a:INTEGER&gt;
Lookup: a

Symbol Table contents:
Symbols: [INTEGER, REAL, &lt;a:INTEGER&gt;]

Run-time GLOBAL_MEMORY contents:
a = 10
</code></pre>
<p>Okay, with all that knowledge and experience under our belt, weâ€™re ready to tackle the topic of nested scopes that we need to understand in order to be able to analyze nested procedures and prepare ourselves to handle procedure and function calls. And thatâ€™s exactly what we are going to do in the next article: dive deep into nested scopes. So donâ€™t forget to bring your swimming gear next time! Stay tuned and see youÂ soon!</p>
<p>å¥½çš„ï¼Œæœ‰äº†è¿™äº›çŸ¥è¯†å’Œç»éªŒï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¤„ç†åµŒå¥—ä½œç”¨åŸŸçš„ä¸»é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£è¿™äº›ä½œç”¨åŸŸï¼Œä»¥ä¾¿èƒ½å¤Ÿåˆ†æåµŒå¥—çš„è¿‡ç¨‹ï¼Œå¹¶ä¸ºå¤„ç†è¿‡ç¨‹å’Œå‡½æ•°è°ƒç”¨åšå¥½å‡†å¤‡ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è¦åšçš„: æ·±å…¥æ¢ç©¶åµŒå¥—åŸŸã€‚æ‰€ä»¥ä¸‹æ¬¡åˆ«å¿˜äº†å¸¦ä¸Šä½ çš„æ¸¸æ³³è£…å¤‡ï¼è¯·ç»§ç»­å…³æ³¨ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šå†è§ï¼</p>
<p><strong>All articles in this series:</strong></p>
<p>æœ¬ç³»åˆ—çš„æ‰€æœ‰æ–‡ç« :</p>
<ul>
<li><a href="https://ruslanspivak.com/lsbasi-part1/">Let's Build A Simple Interpreter. Part 1. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part2/">Let's Build A Simple Interpreter. Part 2. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part3/">Let's Build A Simple Interpreter. Part 3. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part4/">Let's Build A Simple Interpreter. Part 4. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part5/">Let's Build A Simple Interpreter. Part 5. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part6/">Let's Build A Simple Interpreter. Part 6. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part7/">Let's Build A Simple Interpreter. Part 7: Abstract Syntax Trees è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬7éƒ¨åˆ†: æŠ½è±¡è¯­æ³•æ ‘</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part8/">Let's Build A Simple Interpreter. Part 8. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part9/">Let's Build A Simple Interpreter. Part 9. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part10/">Let's Build A Simple Interpreter. Part 10. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part11/">Let's Build A Simple Interpreter. Part 11. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part12/">Let's Build A Simple Interpreter. Part 12. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part13/">Let's Build A Simple Interpreter. Part 13: Semantic Analysis</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part14/">Let's Build A Simple Interpreter. Part 14: Nested Scopes and a Source-to-Source Compiler</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part15/">Let's Build A Simple Interpreter. Part 15.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part16/">Let's Build A Simple Interpreter. Part 16: Recognizing Procedure Calls</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part17/">Let's Build A Simple Interpreter. Part 17: Call Stack and Activation Records</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part18/">Let's Build A Simple Interpreter. Part 18: Executing Procedure Calls</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part19/">Let's Build A Simple Interpreter. Part 19: Nested Procedure Calls</a></li>
</ul>

                        </div>
                        
                            <div class="post-toc">
                                
                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>ztree</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-12/">https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-12/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR ç " target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-12/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-12/&sharesource=qzone&title=[ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part 12.&pics=https://lzxzl.github.io/images/avatar.png?v=1747748455692&summary="><i class="fa fa-qq"></i></a>
                                                                    <a title="æ–°æµªå¾®åš" target="_blank" href="https://service.weibo.com/share/share.php?url=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-12/&sharesource=weibo&title=[ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part 12. + " - " + &pic="https://lzxzl.github.io/images/avatar.png?v=1747748455692 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://lzxzl.github.io/tag/GqQg6_YXk/">#
                    ç¼–è¯‘åŸç†
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://lzxzl.github.io/post/lesslesstu-jie-mi-ma-ji-zhu-greatergreater-di-1-2-zhang-bi-ji/">
                                                                                            ã€Šå›¾è§£å¯†ç æŠ€æœ¯ã€‹ç¬¬1-2ç«  - ç¬”è®°
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-11/">
                                                                                                    [ç¿»è¯‘ä¸å­¦ä¹ ] Let&#39;s Build A Simple Interpreter. Part 11.
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width: 780px;margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '2a44a295dd16ae7d05b8',
        clientSecret: '8030257bc11446a193cf383767567daca0e26312',
        repo: 'lzxzl.github.io',
        owner: 'lzxzl',
        admin: ['lzxzl'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        ztree
                            
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        ztree &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://lzxzl.github.io/" target="_blank">
                                                ztree
                                            </a>
            </div>
            <div id="update" style="display:none;">
                off
            </div>
            
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
                <script>
                    
                    
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    var newDate = new Date();
                    newDate.setTime(1747748455692);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>