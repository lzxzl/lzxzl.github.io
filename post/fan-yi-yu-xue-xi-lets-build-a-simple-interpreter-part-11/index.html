<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    ztree
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://fastly.jsdelivr.net">
<meta name="author" content="ztree">
<meta name="description" content="ç«¹æ–èŠ’é‹è½»èƒœé©¬ï¼Œè°æ€•ï¼Ÿä¸€è“‘çƒŸé›¨ä»»å¹³ç”Ÿã€‚">
<meta name="keywords" content="Binary">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://lzxzl.github.io/styles/main.css" />
<link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
    
            <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                        <!--CDNæ ·å¼-->
                        <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://lzxzl.github.io">
                    ztree
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        å½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        å…³äº
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1747748455692" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://lzxzl.github.io">
                            ztree
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1747748455692" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            å½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            å…³äº
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                [ç¿»è¯‘ä¸å­¦ä¹ ] Let&#39;s Build A Simple Interpreter. Part 11.
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            ztree
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2021-12-06</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">34.9
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">7229</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://lzxzl.github.io/tag/GqQg6_YXk/">ç¼–è¯‘åŸç†</a>
                                
                            </span>
                                            
                                                é˜…è¯»é‡:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                        <div class="post-content">
                            <p>I was sitting in my room the other day and thinking about how much we had covered, and I thought I would recap what weâ€™ve learned so far and what lies ahead ofÂ us.</p>
<p>æœ‰ä¸€å¤©ï¼Œæˆ‘ååœ¨æˆ¿é—´é‡Œï¼Œæƒ³ç€æˆ‘ä»¬å­¦äº†å¤šå°‘ä¸œè¥¿ï¼Œæˆ‘æƒ³æˆ‘åº”è¯¥é‡è¿°ä¸€ä¸‹æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢å­¦åˆ°çš„ä¸œè¥¿ï¼Œä»¥åŠæˆ‘ä»¬å°†è¦å­¦åˆ°çš„ä¸œè¥¿ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_recap.png" alt="" loading="lazy"></figure>
<p>Up until now weâ€™veÂ learned:</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°:</p>
<ul>
<li>How to break sentences into tokens. The process is called <em><strong>lexical analysis</strong></em> and the part of the interpreter that does it is called a <em><strong>lexical analyzer</strong></em>, <em><strong>lexer</strong></em>, <em><strong>scanner</strong></em>, or <em><strong>tokenizer</strong></em>. Weâ€™ve learned how to write our own <em><strong>lexer</strong></em> from the ground up without using regular expressions or any other tools like <a href="https://en.wikipedia.org/wiki/Lex_(software)">Lex</a>.
<ul>
<li><strong>å¦‚ä½•å°†sentencesåˆ†è§£æˆtoken</strong>ã€‚è¿™ä¸ªè¿‡ç¨‹å« <strong>è¯æ³•åˆ†æ</strong>ï¼Œè§£é‡Šå™¨çš„è´Ÿè´£è¿™éƒ¨åˆ†çš„å«åš <em><strong>lexical analyzer</strong></em>, <em><strong>lexer</strong></em>, <em><strong>scanner</strong></em>, or <em><strong>tokenizerã€‚</strong></em></li>
</ul>
</li>
<li>How to recognize a phrase in the stream of tokens. The process of recognizing a phrase in the stream of tokens or, to put it differently, the process of finding structure in the stream of tokens is called <em><strong>parsing</strong></em> or <em><strong>syntax analysis</strong></em>. The part of an interpreter or compiler that performs that job is called a <em><strong>parser</strong></em> or <em><strong>syntax analyzer</strong></em>.
<ul>
<li><strong>å¦‚ä½•åœ¨tokenæµä¸­è¯†åˆ«ä¸€ä¸ªphraseï¼Œæˆ–è€…è¯´å¦‚ä½•åœ¨tokenæµä¸­æ‰¾åˆ°ä¸€ä¸ªç»“æ„</strong>ã€‚è¿™ä¸ªè¿‡ç¨‹å«åš<strong>parsing</strong>æˆ–è€…<strong>syntax</strong> <strong>analysis</strong>ï¼ˆè§£ææˆ–è€…è¯­æ³•åˆ†æï¼‰ã€‚è§£é‡Šå™¨è´Ÿè´£è¿™éƒ¨åˆ†çš„å«åš <strong>parser</strong> æˆ–è€… <strong>syntax analyzer</strong>ã€‚</li>
</ul>
</li>
<li>How to represent a programming languageâ€™s syntax rules with <em><strong>syntax diagrams</strong></em>, which are a graphical representation of a programming languageâ€™s syntax rules. <em><strong>Syntax diagrams</strong></em> visually show us which statements are allowed in our programming language and which areÂ not.
<ul>
<li><strong>å¦‚ä½•ç”¨è¯­æ³•å›¾è¡¨ç¤ºä¸€ä¸ªç¼–ç¨‹è¯­è¨€çš„syntaxè§„åˆ™</strong>ã€‚è¯­æ³•å›¾å¯è§†åŒ–æ˜¾ç¤ºå“ªäº›è¯­å¥æ˜¯å…è®¸çš„ï¼Œå“ªäº›æ˜¯ä¸å…è®¸çš„ã€‚</li>
</ul>
</li>
<li>How to use another widely used notation for specifying the syntax of a programming language. Itâ€™s called <em><strong>context-free grammars</strong></em> (<em><strong>grammars</strong></em>, for short) or <em><strong>BNF</strong></em> (Backus-NaurÂ Form).
<ul>
<li>å¦‚ä½•ä½¿ç”¨å¦ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è¡¨ç¤ºæ³•æ¥æŒ‡å®šç¼–ç¨‹è¯­è¨€çš„syntaxã€‚è¢«ç§°ä¸º <strong>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•</strong>ï¼ˆgrammarsï¼‰æˆ–è€…_<strong>BNF</strong>_ (Backus-NaurÂ Form)ã€‚</li>
</ul>
</li>
<li>How to map a <em><strong>grammar</strong></em> to code and how to write a <em><strong>recursive-descent parser</strong></em>.
<ul>
<li>å¦‚ä½•å°†grammaræ˜ å°„åˆ°codeï¼Œä»¥åŠå¦‚ä½•å†™ä¸€ä¸ªé€’å½’ä¸‹é™è§£æå™¨ã€‚</li>
</ul>
</li>
<li>How to write a really basic <em><strong>interpreter</strong></em>.
<ul>
<li>å¦‚ä½•å†™ä¸€ä¸ªçœŸæ­£çš„åŸºç¡€çš„è§£é‡Šå™¨</li>
</ul>
</li>
<li>How <em><strong>associativity</strong></em> and <em><strong>precedence</strong></em> of operators work and how to construct a grammar using a precedenceÂ table.
<ul>
<li>æ“ä½œç¬¦çš„ç»“åˆæ€§å’Œä¼˜å…ˆçº§å¦‚ä½•å·¥ä½œï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ä¼˜å…ˆè¡¨æ„é€ è¯­æ³•ã€‚</li>
</ul>
</li>
<li>How to build an <em><strong>Abstract Syntax Tree</strong></em> (AST) of a parsed sentence and how to represent the whole source program in Pascal as one big <em><strong>AST</strong></em>.
<ul>
<li>å¦‚ä½•æ„é€ ä¸€ä¸ªparsed sentence çš„ ASTï¼Œä»¥åŠå¦‚ä½•è¡¨ç¤ºåœ¨ä¸€ä¸ªASTä¸­è¡¨ç¤ºPascalçš„æ•´ä¸ªæºç é¡¹ç›®ã€‚</li>
</ul>
</li>
<li>How to walk an AST and how to implement our interpreter as an AST nodeÂ visitor.
<ul>
<li>å¦‚ä½•éå†ASTï¼Œä»¥åŠå¦‚ä½•åœ¨æˆ‘ä»¬çš„è§£é‡Šå™¨ä¸­å®ç°ä¸€ä¸ªASTèŠ‚ç‚¹visitorã€‚</li>
</ul>
</li>
</ul>
<p>With all that knowledge and experience under our belt, weâ€™ve built an interpreter that can scan, parse, and build an AST and interpret, by walking the AST, our very first complete Pascal program. Ladies and gentlemen, I honestly think if youâ€™ve reached this far, you deserve a pat on the back. But donâ€™t let it go to your head. Keep going. Even though weâ€™ve covered a lot of ground, there are even more exciting parts coming ourÂ way.</p>
<p>å‡­å€Ÿæˆ‘ä»¬æ‰€æœ‰çš„çŸ¥è¯†å’Œç»éªŒï¼Œæˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ä¸ªè§£é‡Šå™¨ï¼Œå®ƒå¯ä»¥æ‰«æã€è§£æå’Œæ„å»ºä¸€ä¸ª ASTï¼Œå¹¶é€šè¿‡éå† AST æ¥è§£é‡Šï¼Œè¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªå®Œæ•´çš„ Pascal ç¨‹åºã€‚å¥³å£«ä»¬ï¼Œå…ˆç”Ÿä»¬ï¼Œæˆ‘çœŸè¯šåœ°è®¤ä¸ºï¼Œå¦‚æœä½ ä»¬å·²ç»èµ°åˆ°äº†è¿™ä¸€æ­¥ï¼Œä½ ä»¬åº”è¯¥å¾—åˆ°é¼“åŠ±ã€‚ä½†æ˜¯ä¸è¦è®©å®ƒå†²æ˜äº†ä½ çš„å¤´è„‘ã€‚ç»§ç»­ã€‚å°½ç®¡æˆ‘ä»¬å·²ç»æ¶‰åŠäº†å¾ˆå¤šé¢†åŸŸï¼Œä½†è¿˜æœ‰æ›´å¤šä»¤äººå…´å¥‹çš„éƒ¨åˆ†æ­£åœ¨å‘æˆ‘ä»¬èµ°æ¥ã€‚</p>
<p>With everything weâ€™ve covered so far, we are almost ready to tackle topicsÂ like:</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ¶µç›–äº†æ‰€æœ‰çš„å†…å®¹ï¼Œæˆ‘ä»¬å‡ ä¹å·²ç»å‡†å¤‡å¥½å¤„ç†ä»¥ä¸‹ä¸»é¢˜:</p>
<ul>
<li>Nested procedures andÂ functions
<ul>
<li>åµŒå¥—çš„è¿‡ç¨‹å’Œå‡½æ•°</li>
</ul>
</li>
<li>Procedure and functionÂ calls
<ul>
<li>è¿‡ç¨‹å’Œå‡½æ•°è°ƒç”¨</li>
</ul>
</li>
<li>Semantic analysis (type checking, making sure variables are declared before they are used, and basically checking if a program makesÂ sense)
<ul>
<li>è¯­ä¹‰åˆ†æ(ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿åœ¨ä½¿ç”¨å˜é‡ä¹‹å‰å£°æ˜å®ƒä»¬ï¼ŒåŸºæœ¬ä¸Šæ£€æŸ¥ç¨‹åºæ˜¯å¦æœ‰æ„ä¹‰)</li>
</ul>
</li>
<li>Control flow elements (like IF statements)
<ul>
<li>æ§åˆ¶æµå…ƒç´ ï¼ˆå¦‚ IF è¯­å¥ï¼‰</li>
</ul>
</li>
<li>Aggregate data typesÂ (Records)
<ul>
<li>èšåˆæ•°æ®ç±»å‹(è®°å½•)</li>
</ul>
</li>
<li>More built-inÂ types
<ul>
<li>æ›´å¤šå†…ç½®ç±»å‹</li>
</ul>
</li>
<li>Source-levelÂ debugger
<ul>
<li>æºä»£ç çº§è°ƒè¯•å™¨</li>
</ul>
</li>
<li>Miscellanea (All the other goodness not mentioned aboveÂ ğŸ˜ƒ
<ul>
<li>æ‚é›†(ä¸Šé¢æ²¡æœ‰æåˆ°çš„æ‰€æœ‰å…¶ä»–çš„goodness:)</li>
</ul>
</li>
</ul>
<p>But before we cover those topics, we need to build a solid foundation andÂ infrastructure.</p>
<p>ä½†æ˜¯åœ¨æˆ‘ä»¬è®¨è®ºè¿™äº›ä¸»é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªåšå®çš„ foundation å’Œ infrastructureï¼ˆåŸºç¡€æ¶æ„ï¼‰ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_foundation.png" alt="" loading="lazy"></figure>
<p>This is where we start diving deeper into the super important topic of symbols, symbol tables, and scopes. The topic itself will span several articles. Itâ€™s that important and youâ€™ll see why. Okay, letâ€™s start building that foundation and infrastructure, then, shallÂ we?</p>
<p>æˆ‘ä»¬ä»è¿™é‡Œå¼€å§‹æ›´æ·±å…¥åœ°æ¢è®¨<strong>ç¬¦å·ã€ç¬¦å·è¡¨</strong>å’Œ <strong>åŸŸ</strong> è¿™äº›è¶…çº§é‡è¦çš„ä¸»é¢˜ã€‚è¿™ä¸ªä¸»é¢˜æœ¬èº«å°†è·¨è¶Šå‡ ç¯‡æ–‡ç« ã€‚è¿™å¾ˆé‡è¦ï¼Œä½ ä¼šæ˜ç™½ä¸ºä»€ä¹ˆçš„ã€‚å¥½çš„ï¼Œæˆ‘ä»¬å¼€å§‹å»ºé€ åœ°åŸºå’ŒåŸºç¡€æ¶æ„ï¼Œå¥½å—ï¼Ÿ</p>
<p>First, letâ€™s talk about symbols and why we need to track them. What is a <em><strong>symbol</strong></em>? For our purposes, weâ€™ll informally define <em><strong>symbol</strong></em> as an identifier of some program entity like a variable, subroutine, or built-in type. For symbols to be useful they need to have at least the following information about the program entities theyÂ identify:</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹ç¬¦å·ä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è·Ÿè¸ªå®ƒä»¬ã€‚<strong>ä»€ä¹ˆæ˜¯ç¬¦å·</strong>ï¼Ÿå‡ºäºæˆ‘ä»¬çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†<strong>éæ­£å¼åœ°å°† symbol å®šä¹‰ä¸ºæŸäº›ç¨‹åºå®ä½“(å¦‚å˜é‡ã€å­ä¾‹ç¨‹æˆ–å†…ç½®ç±»å‹)çš„æ ‡è¯†ç¬¦</strong>ã€‚è¦ä½¿ç¬¦å·æœ‰ç”¨ï¼Œå®ƒä»¬è‡³å°‘éœ€è¦æœ‰å…³äºå®ƒä»¬æ‰€è¯†åˆ«çš„ç¨‹åºå®ä½“çš„ä¸‹åˆ—ä¿¡æ¯:</p>
<ul>
<li>Name (for example, â€˜xâ€™, â€˜yâ€™,Â â€˜numberâ€™)
<ul>
<li>Name (ä¾‹å¦‚ï¼Œâ€˜ xâ€™ã€â€˜ yâ€™ã€â€˜ numberâ€™)</li>
</ul>
</li>
<li>Category (Is it a variable, subroutine, or built-inÂ type?)
<ul>
<li>Category(å®ƒæ˜¯å˜é‡ã€å­ä¾‹ç¨‹è¿˜æ˜¯å†…ç½®ç±»å‹?)</li>
</ul>
</li>
<li>Type (INTEGER, REAL)
<ul>
<li>( Type( æ•´æ•°,  å®æ•°)</li>
</ul>
</li>
</ul>
<p>Today weâ€™ll tackle variable symbols and built-in type symbols because weâ€™ve already used variables and types before. By the way, the â€œbuilt-inâ€ type just means a type that hasnâ€™t been defined by you and is available for you right out of the box, like INTEGER and REAL types that youâ€™ve seen and usedÂ before.</p>
<p>ä»Šå¤©æˆ‘ä»¬å°†è®¨è®º<strong>å˜é‡ç¬¦å·</strong>å’Œ<strong>å†…ç½®typeç¬¦å·</strong>ï¼Œå› ä¸ºæˆ‘ä»¬ä»¥å‰å·²ç»ä½¿ç”¨è¿‡å˜é‡å’Œtypeã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œâ€œå†…ç½®â€typeåªæ˜¯æŒ‡ä¸€ç§æ‚¨æ²¡æœ‰å®šä¹‰ï¼Œå¹¶å¯ä»¥ç«‹å³ä½¿ç”¨çš„<strong>type</strong>ï¼Œæ¯”å¦‚æ‚¨ä»¥å‰çœ‹åˆ°å’Œä½¿ç”¨è¿‡çš„ INTEGER å’Œ REAL typeã€‚</p>
<p>Letâ€™s take a look at the following Pascal program, specifically at the variable declaration part. You can see in the picture below that there are four symbols in that section: two variable symbols (<em>x</em> and <em>y</em>) and two built-in type symbols (<em>INTEGER</em> and <em>REAL</em>).</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ Pascal ç¨‹åºï¼Œç‰¹åˆ«æ˜¯å˜é‡å£°æ˜éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥åœ¨ä¸‹é¢çš„å›¾ç‰‡ä¸­çœ‹åˆ°è¯¥éƒ¨åˆ†ä¸­æœ‰å››ä¸ªç¬¦å·: ä¸¤ä¸ªå˜é‡ç¬¦å·(x å’Œ y)å’Œä¸¤ä¸ªå†…ç½®typeç¬¦å·(INTEGER å’Œ REAL)ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_prog_symbols.png" alt="" loading="lazy"></figure>
<p>How can we represent symbols in code? Letâ€™s create a base <em>Symbol</em> class inÂ Python:</p>
<p>å¦‚ä½•åœ¨ä»£ç ä¸­è¡¨ç¤ºç¬¦å·? è®©æˆ‘ä»¬ç”¨ Python åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Symbol ç±»:</p>
<pre><code class="language-python">class Symbol(object):
    def __init__(self, name, type=None):
        self.name = name
        self.type = type
</code></pre>
<p>As you can see, the class takes the <em>name</em> parameter and an optional <em>type</em> parameter (not all symbols may have a type associated with them). What about the category of a symbol? Weâ€™ll encode the category of a symbol in the class name itself, which means weâ€™ll create separate classes to represent different symbolÂ categories.</p>
<p>å¦‚æ‚¨æ‰€è§ï¼Œè¯¥ç±»æ¥å— name å‚æ•°å’Œä¸€ä¸ªå¯é€‰ type å‚æ•°(å¹¶éæ‰€æœ‰ç¬¦å·éƒ½å¯èƒ½å…·æœ‰ä¸å…¶å…³è”çš„type)ã€‚é‚£ä¹ˆç¬¦å·çš„categoryå‘¢ï¼Ÿæˆ‘ä»¬å°†åœ¨ç±»åæœ¬èº«ä¸­å¯¹ç¬¦å·çš„categoryè¿›è¡Œç¼–ç ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†åˆ›å»ºå•ç‹¬çš„ç±»æ¥è¡¨ç¤ºä¸åŒçš„ç¬¦å·categoryã€‚</p>
<p>Letâ€™s start with basic built-in types. Weâ€™ve seen two built-in types so far, when we declared variables: INTEGER and REAL. How do we represent a built-in type symbol in code? Here is oneÂ option:</p>
<p>è®©æˆ‘ä»¬ä»åŸºæœ¬çš„å†…ç½®typeå¼€å§‹ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨å£°æ˜å˜é‡æ—¶ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸¤ä¸ªå†…ç½®ç±»å‹: INTEGER å’Œ REALã€‚å¦‚ä½•åœ¨ä»£ç ä¸­è¡¨ç¤ºå†…ç½®ç±»å‹ç¬¦å·ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªé€‰æ‹©:</p>
<pre><code class="language-python">class BuiltinTypeSymbol(Symbol):
    def __init__(self, name):
        super().__init__(name)

    def __str__(self):
        return self.name

    __repr__ = __str__
</code></pre>
<p>The class inherits from the <em>Symbol</em> class and the constructor requires only a name of the type. The category is encoded in the class name, and the <em>type</em> parameter from the base class for a built-in type symbol is <em>None</em>. The double underscore or <em>dunder</em> (as in â€œDouble UNDERscoreâ€) methods <em><strong>str</strong></em> and <em><strong>repr</strong></em> are special Python methods and weâ€™ve defined them to have a nice formatted message when you print a symbolÂ object.</p>
<p>ç±»ç»§æ‰¿è‡ª Symbol ç±»ï¼Œæ„é€ å‡½æ•°åªéœ€è¦typeçš„åç§°ã€‚categoryç¼–ç åœ¨ç±»åä¸­ï¼Œå†…ç½®typeç¬¦å·çš„åŸºç±»çš„typeå‚æ•°ä¸º Noneã€‚åŒä¸‹åˆ’çº¿æˆ–è€… dunder (å¦‚â€œåŒä¸‹åˆ’çº¿â€)æ–¹æ³• <strong>str</strong> å’Œ <strong>repr</strong> æ˜¯ç‰¹æ®Šçš„ Python æ–¹æ³•ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰å®ƒä»¬åœ¨æ‰“å°ç¬¦å·å¯¹è±¡æ—¶æœ‰ä¸€ä¸ªæ¼‚äº®çš„æ ¼å¼åŒ–æ¶ˆæ¯ã€‚</p>
<p>Download the <a href="https://github.com/rspivak/lsbasi/blob/master/part11/python/spi.py">interpreter file</a> and save it as <em>spi.py</em>; launch a python shell from the same directory where you saved the spi.py file, and play with the class weâ€™ve just definedÂ interactively:</p>
<p>ä¸‹è½½è§£é‡Šå™¨æ–‡ä»¶å¹¶å°†å…¶ä¿å­˜ä¸º spi.py; ä»ä¿å­˜ spi.py æ–‡ä»¶çš„åŒä¸€ä¸ªç›®å½•å¯åŠ¨ python shellï¼Œå¹¶ä»¥äº¤äº’æ–¹å¼ä½¿ç”¨æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„ç±»:</p>
<pre><code class="language-shell">$ python
&gt;&gt;&gt; from spi import BuiltinTypeSymbol
&gt;&gt;&gt; int_type = BuiltinTypeSymbol('INTEGER')
&gt;&gt;&gt; int_type
INTEGER
&gt;&gt;&gt; real_type = BuiltinTypeSymbol('REAL')
&gt;&gt;&gt; real_type
REAL
</code></pre>
<p>How can we represent a variable symbol? Letâ€™s create a <em>VarSymbol</em>Â class:</p>
<p>å¦‚ä½•è¡¨ç¤ºå˜é‡ç¬¦å·? è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª VarSymbol ç±»:</p>
<pre><code class="language-python">class VarSymbol(Symbol):
    def __init__(self, name, type):
        super().__init__(name, type)

    def __str__(self):
        return '&lt;{name}:{type}&gt;'.format(name=self.name, type=self.type)

    __repr__ = __str__
</code></pre>
<p>In the class we made both the <em>name</em> and the <em>type</em> parameters required parameters and the class name <em>VarSymbol</em> clearly indicates that an instance of the class will identify a variable symbol (the category is <em>variable</em>.)</p>
<p>åœ¨ç±»ä¸­ï¼Œæˆ‘ä»¬åŒæ—¶åˆ›å»ºäº†nameå’Œtypeå‚æ•°æ‰€éœ€çš„å‚æ•°ï¼Œç±»å VarSymbol æ¸…æ¥šåœ°è¡¨æ˜ç±»çš„å®ä¾‹å°†è¯†åˆ«ä¸€ä¸ªå˜é‡ç¬¦å·(categoryæ˜¯å˜é‡)</p>
<p>Back to the interactive python shell to see how we can manually construct instances for our variable symbols now that we know how to construct <em>BuiltinTypeSymbol</em> classÂ instances:</p>
<p>å›åˆ°äº¤äº’å¼ python shellï¼Œçœ‹çœ‹æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•æ„é€ _BuiltinTypeSymbol_ç±»å®ä¾‹ï¼Œé‚£å¦‚ä½•æ‰‹åŠ¨æ„å»ºå˜é‡ç¬¦å·çš„å®ä¾‹:</p>
<pre><code class="language-shell">$ python
&gt;&gt;&gt; from spi import BuiltinTypeSymbol, VarSymbol
&gt;&gt;&gt; int_type = BuiltinTypeSymbol('INTEGER')
&gt;&gt;&gt; real_type = BuiltinTypeSymbol('REAL')
&gt;&gt;&gt;
&gt;&gt;&gt; var_x_symbol = VarSymbol('x', int_type)
&gt;&gt;&gt; var_x_symbol
&lt;x:INTEGER&gt;
&gt;&gt;&gt; var_y_symbol = VarSymbol('y', real_type)
&gt;&gt;&gt; var_y_symbol
&lt;y:REAL&gt;
</code></pre>
<p>As you can see, we first create an instance of a built-in type symbol and then pass it as a parameter to <em>VarSymbol</em>â€˜sÂ constructor.</p>
<p>å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªå†…ç½®typeç¬¦å·çš„å®ä¾‹ï¼Œç„¶åå°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ VarSymbol çš„æ„é€ å‡½æ•°ã€‚</p>
<p>Here is the hierarchy of symbols weâ€™ve defined in visualÂ form:</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬ä»¥è§†è§‰å½¢å¼å®šä¹‰çš„ç¬¦å·å±‚æ¬¡:</p>
<figure data-type="image" tabindex="4"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_symbol_hierarchy.png" alt="" loading="lazy"></figure>
<p>So far so good, but we havenâ€™t answered the question yet as to why we even need to track those symbols in the firstÂ place.</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸é”™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å›ç­”ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é¦–å…ˆè¿½è¸ªè¿™äº›ç¬¦å·çš„é—®é¢˜ã€‚</p>
<p>Here are some of theÂ reasons:</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›åŸå› :</p>
<ul>
<li>To make sure that when we assign a value to a variable the types are correct (typeÂ checking)
<ul>
<li>ä¸ºäº†ç¡®ä¿åœ¨ç»™å˜é‡èµ‹å€¼æ—¶ï¼Œç±»å‹æ˜¯æ­£ç¡®çš„(ç±»å‹æ£€æŸ¥)</li>
</ul>
</li>
<li>To make sure that a variable is declared before it isÂ used
<ul>
<li>ç¡®ä¿åœ¨ä½¿ç”¨å˜é‡ä¹‹å‰å£°æ˜è¯¥å˜é‡</li>
</ul>
</li>
</ul>
<p>Take a look at the following incorrect Pascal program, forÂ example:</p>
<p>çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¸æ­£ç¡®çš„ Pascal ç¨‹åºï¼Œä¾‹å¦‚:</p>
<figure data-type="image" tabindex="5"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_symtracking.png" alt="" loading="lazy"></figure>
<p>There are two problems with the program above (you can compile it with <a href="http://www.freepascal.org/"><em>fpc</em></a> to see it forÂ yourself):</p>
<p>ä¸Šé¢è¿™ä¸ªç¨‹åºæœ‰ä¸¤ä¸ªé—®é¢˜(ä½ å¯ä»¥ç”¨ fpc ç¼–è¯‘å®ƒï¼Œè‡ªå·±çœ‹çœ‹) :</p>
<ol>
<li>In the expression _â€œx := 2 + y;â€ _ we assigned a decimal value to the variable â€œxâ€ that was declared as integer. That wouldnâ€™t compile because the types areÂ incompatible.</li>
</ol>
<p>åœ¨çŸ­è¯­<code>_x := 2 + y;_</code>ä¸­ï¼Œæˆ‘ä»¬ç»™å£°æ˜ä¸ºæ•´æ•°çš„å˜é‡â€œ xâ€èµ‹äº†ä¸€ä¸ªå®æ•°å€¼ã€‚å› ä¸ºç±»å‹ä¸å…¼å®¹ï¼Œæ‰€ä»¥ä¸èƒ½ç¼–è¯‘</p>
<ol start="2">
<li>In the assignment statement _â€œx := a;â€ _we referenced the variable â€œaâ€ that wasnâ€™t declared -Â wrong!</li>
</ol>
<p>åœ¨èµ‹å€¼è¯­å¥<code>_x := a;_</code>ä¸­ï¼Œæˆ‘ä»¬å¼•ç”¨äº†æœªè¢«å£°æ˜çš„å˜é‡â€œ aâ€</p>
<p>To be able to identify cases like that even before interpreting/evaluating the source code of the program at run-time, we need to track program symbols. And where do we store the symbols that we track? I think youâ€™ve guessed it right - in the symbolÂ table!</p>
<p>ä¸ºäº†èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è§£é‡Š/è¯„ä¼°ç¨‹åºçš„æºä»£ç ä¹‹å‰è¯†åˆ«è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è·Ÿè¸ªç¨‹åºç¬¦å·ã€‚æˆ‘ä»¬åœ¨å“ªé‡Œå­˜å‚¨æˆ‘ä»¬è¿½è¸ªçš„ç¬¦å·ï¼Ÿæˆ‘æƒ³ä½ å·²ç»çŒœå¯¹äº†â€”â€”åœ¨ç¬¦å·è¡¨é‡Œï¼</p>
<p>What is a <em><strong>symbol table</strong></em>? A <em><strong>symbol table</strong></em> is an abstract data type (<em><strong>ADT</strong></em>) for tracking various symbols in source code. Today weâ€™re going to implement our symbol table as a separate class with some helperÂ methods:</p>
<p>ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨ï¼Ÿ<strong>ç¬¦å·è¡¨æ˜¯ä¸€ä¸ªç”¨äºè·Ÿè¸ªæºä»£ç ä¸­å„ç§ç¬¦å·çš„æŠ½è±¡æ•°æ®ç±»å‹(ADT)</strong>ã€‚ä»Šå¤©æˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº› helper æ–¹æ³•å°†æˆ‘ä»¬çš„ç¬¦å·è¡¨ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å®ç°:</p>
<pre><code class="language-python">class SymbolTable(object):
    def __init__(self):
        self._symbols = {}

    def __str__(self):
        s = 'Symbols: {symbols}'.format(
            symbols=[value for value in self._symbols.values()]
        )
        return s

    __repr__ = __str__

    def define(self, symbol):
        print('Define: %s' % symbol)
        self._symbols[symbol.name] = symbol

    def lookup(self, name):
        print('Lookup: %s' % name)
        symbol = self._symbols.get(name)
        # 'symbol' is either an instance of the Symbol class or 'None'
        return symbol
</code></pre>
<p>There are two main operations that we will be performing with the symbol table: storing symbols and looking them up by name: hence, we need two helper methods - <em>define</em> and <em>lookup</em>.</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ç¬¦å·è¡¨æ‰§è¡Œä¸¤ä¸ªä¸»è¦æ“ä½œ: <strong>å­˜å‚¨ç¬¦å·</strong>å¹¶<strong>æŒ‰åç§°æŸ¥æ‰¾å®ƒä»¬</strong>: å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªhelper æ–¹æ³•â€”â€” define å’Œ lookupã€‚</p>
<p>The method <em>define</em> takes a symbol as a parameter and stores it internally in its _<em>symbols</em> ordered dictionary using the symbolâ€™s name as a key and the symbol instance as a value. The method <em>lookup</em> takes a symbol name as a parameter and returns a symbol if it finds it or â€œNoneâ€ if itÂ doesnâ€™t.</p>
<p>æ–¹æ³• <em><strong>define</strong></em> å°†ç¬¦å·ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨<strong>ç¬¦å·åä½œä¸ºé”®</strong>å’Œ<strong>ç¬¦å·å®ä¾‹ä½œä¸ºå€¼</strong>çš„ _symbols æœ‰åºå­—å…¸ä¸­ã€‚æ–¹æ³• <strong><em>lookup</em></strong> æ¥å—ä¸€ä¸ªç¬¦å·åä½œä¸ºå‚æ•°ï¼Œå¦‚æœæ‰¾åˆ°å®ƒå°±è¿”å›ä¸€ä¸ªç¬¦å·ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›â€œ Noneâ€ã€‚</p>
<p>Letâ€™s manually populate our symbol table for the same Pascal program weâ€™ve used just recently where we were manually creating variable and built-in typeÂ symbols:</p>
<p>è®©æˆ‘ä»¬ä¸ºæœ€è¿‘ä½¿ç”¨çš„ Pascal ç¨‹åºæ‰‹åŠ¨å¡«å……ç¬¦å·è¡¨ï¼Œæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºå˜é‡å’Œå†…ç½®ç±»å‹ç¬¦å·:</p>
<pre><code class="language-pascal">PROGRAM Part11;
VAR
   x : INTEGER;
   y : REAL;

BEGIN

END.
</code></pre>
<p>Launch a Python shell again and followÂ along:</p>
<p>å†æ¬¡å¯åŠ¨ä¸€ä¸ª Python shellï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<pre><code class="language-python">$ python
&gt;&gt;&gt; from spi import SymbolTable, BuiltinTypeSymbol, VarSymbol
&gt;&gt;&gt; symtab = SymbolTable()
&gt;&gt;&gt; int_type = BuiltinTypeSymbol('INTEGER')
&gt;&gt;&gt; symtab.define(int_type)
Define: INTEGER
&gt;&gt;&gt; symtab
Symbols: [INTEGER]
&gt;&gt;&gt;
&gt;&gt;&gt; var_x_symbol = VarSymbol('x', int_type)
&gt;&gt;&gt; symtab.define(var_x_symbol)
Define: &lt;x:INTEGER&gt;
&gt;&gt;&gt; symtab
Symbols: [INTEGER, &lt;x:INTEGER&gt;]
&gt;&gt;&gt;
&gt;&gt;&gt; real_type = BuiltinTypeSymbol('REAL')
&gt;&gt;&gt; symtab.define(real_type)
Define: REAL
&gt;&gt;&gt; symtab
Symbols: [INTEGER, &lt;x:INTEGER&gt;, REAL]
&gt;&gt;&gt;
&gt;&gt;&gt; var_y_symbol = VarSymbol('y', real_type)
&gt;&gt;&gt; symtab.define(var_y_symbol)
Define: &lt;y:REAL&gt;
&gt;&gt;&gt; symtab
Symbols: [INTEGER, &lt;x:INTEGER&gt;, REAL, &lt;y:REAL&gt;]
</code></pre>
<p>If you looked at the contents of the _<em>symbols</em> dictionary it would look something likeÂ this:</p>
<p>å¦‚æœä½ æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç¬¦å·å­—å…¸çš„å†…å®¹ï¼Œä½ ä¼šå‘ç°:</p>
<figure data-type="image" tabindex="6"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_symtab.png" alt="" loading="lazy"></figure>
<p>How do we automate the process of building the symbol table? Weâ€™ll just write another node visitor that walks the AST built by our parser! This is another example of how useful it is to have an intermediary form like AST. Instead of extending our parser to deal with the symbol table, we separate concerns and write a new node visitor class. Nice and clean.Â ğŸ˜ƒ</p>
<p>æˆ‘ä»¬å¦‚ä½•å°†æ„å»ºç¬¦å·è¡¨çš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Ÿåªéœ€è¦ç¼–å†™å¦ä¸€ä¸ªèŠ‚ç‚¹ visitor æ¥è®¿é—®ç”±è§£æå™¨æ„å»ºçš„ ASTï¼è¿™æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜ä½¿ç”¨ç±»ä¼¼ AST çš„ä¸­é—´è¡¨ç¤ºæ˜¯å¤šä¹ˆæœ‰ç”¨ã€‚æˆ‘ä»¬æ²¡æœ‰æ‰©å±•è§£æå™¨æ¥å¤„ç†ç¬¦å·è¡¨ï¼Œè€Œæ˜¯åˆ†ç¦»å…³æ³¨ç‚¹å¹¶ç¼–å†™ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹visitorç±»ã€‚æ¼‚äº®åˆå¹²å‡€ã€‚ğŸ˜ƒ</p>
<p>Before doing that, though, letâ€™s extend our <em>SymbolTable</em> class to initialize the built-in types when the symbol table instance is created. Here is the full source code for todayâ€™s <em>SymbolTable</em>Â class:</p>
<p>ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ‰©å±• <em>SymbolTable</em> ç±»ï¼Œä»¥ä¾¿åœ¨åˆ›å»ºç¬¦å·è¡¨å®ä¾‹æ—¶åˆå§‹åŒ–å†…ç½®typeã€‚ä¸‹é¢æ˜¯ä»Šå¤©çš„ <em>SymbolTable</em> ç±»çš„å®Œæ•´æºä»£ç :</p>
<pre><code class="language-python">class SymbolTable(object):
    def __init__(self):
        self._symbols = OrderedDict()
        self._init_builtins()

    def _init_builtins(self):
        self.define(BuiltinTypeSymbol('INTEGER'))
        self.define(BuiltinTypeSymbol('REAL'))

    def __str__(self):
        s = 'Symbols: {symbols}'.format(
            symbols=[value for value in self._symbols.values()]
        )
        return s

    __repr__ = __str__

    def define(self, symbol):
        print('Define: %s' % symbol)
        self._symbols[symbol.name] = symbol

    def lookup(self, name):
        print('Lookup: %s' % name)
        symbol = self._symbols.get(name)
        # 'symbol' is either an instance of the Symbol class or 'None'
        return symbol

</code></pre>
<p>Now onto the <em>SymbolTableBuilder</em> AST nodeÂ visitor:</p>
<p>ç°åœ¨åˆ° <em>SymbolTableBuilder</em> AST èŠ‚ç‚¹visitor:</p>
<pre><code class="language-python">class SymbolTableBuilder(NodeVisitor):
    def __init__(self):
        self.symtab = SymbolTable()

    def visit_Block(self, node):
        for declaration in node.declarations:
            self.visit(declaration)
        self.visit(node.compound_statement)

    def visit_Program(self, node):
        self.visit(node.block)

    def visit_BinOp(self, node):
        self.visit(node.left)
        self.visit(node.right)

    def visit_Num(self, node):
        pass

    def visit_UnaryOp(self, node):
        self.visit(node.expr)

    def visit_Compound(self, node):
        for child in node.children:
            self.visit(child)

    def visit_NoOp(self, node):
        pass

    def visit_VarDecl(self, node):
        type_name = node.type_node.value
        type_symbol = self.symtab.lookup(type_name)
        var_name = node.var_node.value
        var_symbol = VarSymbol(var_name, type_symbol)
        self.symtab.define(var_symbol)
</code></pre>
<p>Youâ€™ve seen most of those methods before in the <em>Interpreter</em> class, but the <em>visit_VarDecl</em> method deserves some special attention. Here it isÂ again:</p>
<p>ä½ ä»¥å‰åœ¨ Interpreter ç±»ä¸­è§è¿‡è¿™äº›æ–¹æ³•ä¸­çš„å¤§å¤šæ•°ï¼Œä½†æ˜¯ <em>visit_VarDecl</em> æ–¹æ³•å€¼å¾—ç‰¹åˆ«æ³¨æ„ã€‚å†çœ‹çœ‹:</p>
<pre><code class="language-python">def visit_VarDecl(self, node):
    type_name = node.type_node.value
    type_symbol = self.symtab.lookup(type_name)
    var_name = node.var_node.value
    var_symbol = VarSymbol(var_name, type_symbol)
    self.symtab.define(var_symbol)
</code></pre>
<p>This method is responsible for visiting (walking) a <em>VarDecl</em> AST node and storing the corresponding symbol in the symbol table. First, the method looks up the built-in type symbol by name in the symbol table, then it creates an instance of the <em>VarSymbol</em> class and stores (defines) it in the symbolÂ table.</p>
<p>æ­¤æ–¹æ³•è´Ÿè´£è®¿é—®(éå†) VarDecl AST èŠ‚ç‚¹å¹¶å°†ç›¸åº”çš„ç¬¦å·å­˜å‚¨åœ¨ç¬¦å·è¡¨ä¸­ã€‚é¦–å…ˆï¼Œè¯¥æ–¹æ³•åœ¨ symbol è¡¨ä¸­æŒ‰åç§°æŸ¥æ‰¾å†…ç½®typeç¬¦å·ï¼Œç„¶ååˆ›å»º VarSymbol ç±»çš„å®ä¾‹ï¼Œå¹¶å°†å…¶å­˜å‚¨(å®šä¹‰)åˆ° symbol è¡¨ä¸­ã€‚</p>
<p>Letâ€™s take our <em>SymbolTableBuilder</em> AST walker for a test drive and see it inÂ action:</p>
<p>è®©æˆ‘ä»¬ç”¨ <em>SymbolTableBuilder</em> AST walker ä½œä¸ºä¸€ä¸ªæµ‹è¯•é©±åŠ¨å™¨ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„:</p>
<pre><code class="language-python">$ python
&gt;&gt;&gt; from spi import Lexer, Parser, SymbolTableBuilder
&gt;&gt;&gt; text = &quot;&quot;&quot;
... PROGRAM Part11;
... VAR
...    x : INTEGER;
...    y : REAL;
...
... BEGIN
...
... END.
... &quot;&quot;&quot;
&gt;&gt;&gt; lexer = Lexer(text)
&gt;&gt;&gt; parser = Parser(lexer)
&gt;&gt;&gt; tree = parser.parse()
&gt;&gt;&gt; symtab_builder = SymbolTableBuilder()
Define: INTEGER
Define: REAL
&gt;&gt;&gt; symtab_builder.visit(tree)
Lookup: INTEGER
Define: &lt;x:INTEGER&gt;
Lookup: REAL
Define: &lt;y:REAL&gt;
&gt;&gt;&gt; # Letâ€™s examine the contents of our symbol table
â€¦
&gt;&gt;&gt; symtab_builder.symtab
Symbols: [INTEGER, REAL, &lt;x:INTEGER&gt;, &lt;y:REAL&gt;]
</code></pre>
<p>In the interactive session above, you can see the sequence of â€œDefine: â€¦â€ and â€œLookup: â€¦â€ messages that indicate the order in which symbols are defined and looked up in the symbol table. The last command in the session prints the contents of the symbol table and you can see that itâ€™s exactly the same as the contents of the symbol table that weâ€™ve built manually before. The magic of AST node visitors is that they pretty much do all the work for you.Â ğŸ˜ƒ</p>
<p>åœ¨ä¸Šé¢çš„äº¤äº’å¼ä¼šè¯ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°â€œ Define: ...â€å’Œâ€œ Lookup: ...â€æ¶ˆæ¯çš„é¡ºåºï¼Œå®ƒä»¬æŒ‡ç¤ºåœ¨ç¬¦å·è¡¨ä¸­å®šä¹‰å’ŒæŸ¥æ‰¾ç¬¦å·çš„é¡ºåºã€‚ä¼šè¯ä¸­çš„æœ€åä¸€ä¸ªå‘½ä»¤è¾“å‡º symbol è¡¨çš„å†…å®¹ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å®ƒä¸æˆ‘ä»¬ä¹‹å‰æ‰‹åŠ¨æ„å»ºçš„ symbol è¡¨çš„å†…å®¹å®Œå…¨ç›¸åŒã€‚AST èŠ‚ç‚¹visitor çš„ç¥å¥‡ä¹‹å¤„åœ¨äºï¼Œä»–ä»¬å‡ ä¹ä¸ºæ‚¨å®Œæˆäº†æ‰€æœ‰çš„å·¥ä½œã€‚ğŸ˜ƒ</p>
<p>We can already put our symbol table and symbol table builder to good use: we can use them to verify that variables are declared before they are used in assignments and expressions. All we need to do is just extend the visitor with two more methods: <em>visit_Assign</em> and <em>visit_Var</em>:</p>
<p>æˆ‘ä»¬å·²ç»å¯ä»¥å¾ˆå¥½åœ°ä½¿ç”¨æˆ‘ä»¬çš„ç¬¦å·è¡¨å’Œç¬¦å·è¡¨æ„å»ºå™¨: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥éªŒè¯å˜é‡åœ¨ç”¨äºèµ‹å€¼å’Œè¡¨è¾¾å¼ä¹‹å‰æ˜¯å¦å·²ç»å£°æ˜äº†ã€‚æˆ‘ä»¬éœ€è¦åšçš„åªæ˜¯ç”¨ä¸¤ä¸ªæ–¹æ³•æ‰©å±•visitor: visit_Assign å’Œvisit_Var:</p>
<pre><code class="language-python">def visit_Assign(self, node):
    var_name = node.left.value # è·å–nodeçš„å·¦å­èŠ‚ç‚¹çš„å˜é‡åï¼Œå³èµ‹å€¼è¡¨è¾¾å¼å·¦è¾¹çš„å˜é‡çš„name
    var_symbol = self.symtab.lookup(var_name) # åœ¨ç¬¦å·è¡¨æœç´¢ç¬¦å·
    if var_symbol is None:
        raise NameError(repr(var_name))

    self.visit(node.right)

def visit_Var(self, node):
    var_name = node.value
    var_symbol = self.symtab.lookup(var_name)

    if var_symbol is None:
        raise NameError(repr(var_name))
</code></pre>
<p>These methods will raise a <em>NameError</em> exception if they cannot find the symbol in the symbolÂ table.</p>
<p>å¦‚æœè¿™äº›æ–¹æ³•æ— æ³•åœ¨ç¬¦å·è¡¨ä¸­æ‰¾åˆ°ç¬¦å·ï¼Œåˆ™ä¼šå¼•å‘ NameError å¼‚å¸¸ã€‚</p>
<p>Take a look at the following program, where we reference the variable â€œbâ€ that hasnâ€™t been declaredÂ yet:</p>
<p>çœ‹çœ‹ä¸‹é¢çš„ç¨‹åºï¼Œæˆ‘ä»¬å¼•ç”¨äº†ä¸€ä¸ªå°šæœªå£°æ˜çš„å˜é‡â€œ bâ€:</p>
<pre><code class="language-pascal">PROGRAM NameError1;
VAR
   a : INTEGER;

BEGIN
   a := 2 + b;
END.
</code></pre>
<p>Letâ€™s see what happens if we construct an AST for the program and pass it to our symbol table builder toÂ visit:</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœæˆ‘ä»¬ä¸ºç¨‹åºæ„é€ ä¸€ä¸ª AST å¹¶å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„ç¬¦å·è¡¨æ„å»ºå™¨ä»¥è®¿é—®å®ƒä¼šå‘ç”Ÿä»€ä¹ˆ:</p>
<pre><code class="language-python">$ python
&gt;&gt;&gt; from spi import Lexer, Parser, SymbolTableBuilder
&gt;&gt;&gt; text = &quot;&quot;&quot;
... PROGRAM NameError1;
... VAR
...    a : INTEGER;
...
... BEGIN
...    a := 2 + b;
... END.
... &quot;&quot;&quot;
&gt;&gt;&gt; lexer = Lexer(text)
&gt;&gt;&gt; parser = Parser(lexer)
&gt;&gt;&gt; tree = parser.parse()
&gt;&gt;&gt; symtab_builder = SymbolTableBuilder()
Define: INTEGER
Define: REAL
&gt;&gt;&gt; symtab_builder.visit(tree)
Lookup: INTEGER
Define: &lt;a:INTEGER&gt;
Lookup: a
Lookup: b
Traceback (most recent call last):
  ...
  File &quot;spi.py&quot;, line 674, in visit_Var
    raise NameError(repr(var_name))
NameError: 'b'
</code></pre>
<p>Exactly what we wereÂ expecting!</p>
<p>è¿™æ­£æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„ï¼</p>
<p>Here is another error case where we try to assign a value to a variable that hasnâ€™t been defined yet, in this case the variableÂ â€˜aâ€™:</p>
<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¯•å›¾ç»™ä¸€ä¸ªå°šæœªå®šä¹‰çš„å˜é‡èµ‹å€¼ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå˜é‡ a:</p>
<pre><code class="language-pascal">PROGRAM NameError2;
VAR
   b : INTEGER;

BEGIN
   b := 1;
   a := b + 2;
END.
</code></pre>
<p>Meanwhile, in the PythonÂ shell:</p>
<p>åŒæ—¶ï¼Œåœ¨ Python shell ä¸­:</p>
<pre><code class="language-python">&gt;&gt;&gt; from spi import Lexer, Parser, SymbolTableBuilder
&gt;&gt;&gt; text = &quot;&quot;&quot;
... PROGRAM NameError2;
... VAR
...    b : INTEGER;
...
... BEGIN
...    b := 1;
...    a := b + 2;
... END.
... &quot;&quot;&quot;
&gt;&gt;&gt; lexer = Lexer(text)
&gt;&gt;&gt; parser = Parser(lexer)
&gt;&gt;&gt; tree = parser.parse()
&gt;&gt;&gt; symtab_builder = SymbolTableBuilder()
Define: INTEGER
Define: REAL
&gt;&gt;&gt; symtab_builder.visit(tree)
Lookup: INTEGER
Define: &lt;b:INTEGER&gt;
Lookup: b
Lookup: a
Traceback (most recent call last):
  ...
  File &quot;spi.py&quot;, line 665, in visit_Assign
    raise NameError(repr(var_name))
NameError: 'a'
</code></pre>
<p>Great, our new visitor caught this problemÂ too!</p>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬çš„æ–°visitorä¹Ÿæ£€æµ‹åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼</p>
<p>I would like to emphasize the point that all those checks that our <em>SymbolTableBuilder</em> AST visitor makes are made before the run-time, so before our interpreter actually evaluates the source program. To drive the point home if we were to interpret the followingÂ program:</p>
<p>æˆ‘æƒ³å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬çš„ <em>SymbolTableBuilder</em> AST visitor æ‰€åšçš„æ‰€æœ‰æ£€æŸ¥éƒ½æ˜¯åœ¨è¿è¡Œæ—¶ä¹‹å‰è¿›è¡Œçš„ï¼Œå› æ­¤æ˜¯åœ¨æˆ‘ä»¬çš„è§£é‡Šå™¨å®é™…è¯„ä¼°æºç¨‹åºä¹‹å‰ã€‚å¦‚æœæˆ‘ä»¬è¦è§£é‡Šä¸‹é¢çš„ç¨‹åºï¼Œå°±è¦æŠŠè¿™ä¸€ç‚¹è¯´æ¸…æ¥š:</p>
<pre><code class="language-pascal">PROGRAM Part11;
VAR
   x : INTEGER;
BEGIN
   x := 2;
END.
</code></pre>
<p>The contents of the symbol table and the run-time GLOBAL_MEMORY right before the program exited would look something likeÂ this:</p>
<p>åœ¨ç¨‹åºé€€å‡ºä¹‹å‰ï¼Œç¬¦å·è¡¨å’Œè¿è¡Œæ—¶ GLOBAL_MEMORY çš„å†…å®¹å¦‚ä¸‹:</p>
<figure data-type="image" tabindex="7"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_symtab_vs_globmem.png" alt="" loading="lazy"></figure>
<p>Do you see the difference? Can you see that the symbol table doesnâ€™t hold the value 2 for variable â€œxâ€? Thatâ€™s solely the interpreterâ€™s jobÂ now.</p>
<p>ä½ çœ‹å‡ºåŒºåˆ«äº†å—ï¼Ÿä½ èƒ½çœ‹åˆ°ç¬¦å·è¡¨ä¸­ä¸åŒ…å«å˜é‡â€œ xâ€çš„å€¼2å—ï¼Ÿè¿™ç°åœ¨å®Œå…¨æ˜¯ç¿»è¯‘çš„å·¥ä½œäº†ã€‚</p>
<p>Remember the picture from <a href="https://ruslanspivak.com/lsbasi-part9/">Part 9</a> where the Symbol Table was used as globalÂ memory?</p>
<p>è¿˜è®°å¾—ç¬¬9éƒ¨åˆ†ä¸­çš„å›¾ç‰‡å—ï¼Œå…¶ä¸­ä½¿ç”¨ç¬¦å·è¡¨ä½œä¸ºå…¨å±€å†…å­˜ï¼Ÿ</p>
<figure data-type="image" tabindex="8"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part9_ast_st02.png" alt="" loading="lazy"></figure>
<p>No more! We effectively got rid of the hack where symbol table did double duty as globalÂ memory.</p>
<p>æˆ‘ä»¬æœ‰æ•ˆåœ°è§£å†³äº†ç¬¦å·è¡¨ä½œä¸ºå…¨å±€å†…å­˜çš„åŒé‡ä½œç”¨çš„hacké—®é¢˜ã€‚</p>
<p>Letâ€™s put it all together and test our new interpreter with the followingÂ program:</p>
<p>è®©æˆ‘ä»¬æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼Œç”¨ä¸‹é¢çš„ç¨‹åºæµ‹è¯•æˆ‘ä»¬çš„æ–°è§£é‡Šå™¨:</p>
<pre><code class="language-pascal">PROGRAM Part11;
VAR
   number : INTEGER;
   a, b   : INTEGER;
   y      : REAL;

BEGIN {Part11}
   number := 2;
   a := number ;
   b := 10 * a + 10 * number DIV 4;
   y := 20 / 7 + 3.14
END.  {Part11}
</code></pre>
<p>Save the program as part11.pas and fire up theÂ interpreter:</p>
<p>å°†ç¨‹åºä¿å­˜ä¸º part11.pas å¹¶å¯åŠ¨è§£é‡Šå™¨:</p>
<pre><code class="language-python">$ python spi.py part11.pas
Define: INTEGER
Define: REAL
Lookup: INTEGER
Define: &lt;number:INTEGER&gt;
Lookup: INTEGER
Define: &lt;a:INTEGER&gt;
Lookup: INTEGER
Define: &lt;b:INTEGER&gt;
Lookup: REAL
Define: &lt;y:REAL&gt;
Lookup: number
Lookup: a
Lookup: number
Lookup: b
Lookup: a
Lookup: number
Lookup: y

Symbol Table contents:
Symbols: [INTEGER, REAL, &lt;number:INTEGER&gt;, &lt;a:INTEGER&gt;, &lt;b:INTEGER&gt;, &lt;y:REAL&gt;]

Run-time GLOBAL_MEMORY contents:
a = 2
b = 25
number = 2
y = 5.99714285714
</code></pre>
<p>Iâ€™d like to draw your attention again to the fact that the <em>Interpreter</em> class has nothing to do with building the symbol table and it relies on the <em>SymbolTableBuilder</em> to make sure that the variables in the source code are properly declared before they are used by the <em>Interpreter</em>.</p>
<p>æˆ‘æƒ³å†æ¬¡æé†’å¤§å®¶æ³¨æ„è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³ Interpreter ç±»ä¸æ„å»ºç¬¦å·è¡¨æ— å…³ï¼Œå®ƒä¾èµ–äº <em>SymbolTableBuilder</em> æ¥ç¡®ä¿æºä»£ç ä¸­çš„å˜é‡åœ¨è¢« Interpreter ä½¿ç”¨ä¹‹å‰è¢«æ­£ç¡®å£°æ˜ã€‚</p>
<p><strong>Check yourÂ understanding</strong></p>
<p>æ£€æŸ¥ä½ çš„ç†è§£</p>
<ul>
<li>What is aÂ symbol? ä»€ä¹ˆæ˜¯ç¬¦å·ï¼Ÿ</li>
</ul>
<blockquote>
<p><strong>æŸäº›ç¨‹åºå®ä½“(å¦‚å˜é‡ã€å­ä¾‹ç¨‹æˆ–å†…ç½®ç±»å‹)çš„æ ‡è¯†ç¬¦</strong></p>
</blockquote>
<ul>
<li>Why do we need to trackÂ symbols? ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è¿½è¸ªç¬¦å·ï¼Ÿ</li>
</ul>
<blockquote>
<ol>
<li>ä¸ºäº†ç¡®ä¿åœ¨ç»™å˜é‡èµ‹å€¼æ—¶ï¼Œtypeæ˜¯æ­£ç¡®çš„ï¼ˆtypeæ£€æŸ¥ï¼‰</li>
<li>ç¡®ä¿åœ¨ä½¿ç”¨å˜é‡ä¹‹å‰å£°æ˜è¯¥å˜é‡ã€‚</li>
</ol>
</blockquote>
<ul>
<li>What is a symbolÂ table? ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨ï¼Ÿ</li>
</ul>
<blockquote>
<p>ç¬¦å·è¡¨æ˜¯ä¸€ä¸ªç”¨äºè¿½è¸ªç¨‹åº<strong>æºä»£ç ä¸­å„ç§ç¬¦å·çš„æŠ½è±¡æ•°æ®ç±»å‹(ADT)</strong></p>
</blockquote>
<ul>
<li>What is the difference between defining a symbol and resolving/looking up theÂ symbol? å®šä¹‰ä¸€ä¸ªç¬¦å·å’Œè§£æ/æŸ¥æ‰¾è¿™ä¸ªç¬¦å·æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
</ul>
<blockquote>
<ul>
<li>å®šä¹‰ä¸€ä¸ªç¬¦å·å°±æ˜¯æŠŠè¯¥ç¬¦å·æ’å…¥åˆ°ç¬¦å·è¡¨ä¸­ï¼Œç¬¦å·åä½œä¸ºé”®ï¼Œç¬¦å·å®ä¾‹ä½œä¸ºå€¼ï¼ˆå€¼ä¸å†æ˜¯Part9é‡Œçš„ç¬¦å·å€¼äº†ï¼‰ã€‚</li>
<li>è§£æ/æŸ¥æ‰¾ä¸€ä¸ªç¬¦å·å°±æ˜¯åœ¨ç¬¦å·è¡¨ä¸­é€šè¿‡ç¬¦å·åæœç´¢è¿™ä¸ªç¬¦å·ï¼Œæ‰¾åˆ°å°±è¿”å›ç¬¦å·å®ä¾‹ï¼Œå¦åˆ™è¿”å›Noneã€‚</li>
</ul>
</blockquote>
<blockquote>
<p>æ–¹æ³• <em><strong>define</strong></em> å°†ç¬¦å·ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨<strong>ç¬¦å·åä½œä¸ºé”®</strong>å’Œ<strong>ç¬¦å·å®ä¾‹ä½œä¸ºå€¼</strong>çš„ _symbols æœ‰åºå­—å…¸ä¸­ã€‚æ–¹æ³• <strong><em>lookup</em></strong> æ¥å—ä¸€ä¸ªç¬¦å·åä½œä¸ºå‚æ•°ï¼Œå¦‚æœæ‰¾åˆ°å®ƒå°±è¿”å›ä¸€ä¸ªç¬¦å·ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›â€œ Noneâ€ã€‚</p>
</blockquote>
<ul>
<li>Given the following small Pascal program, what would be the contents of the symbol table, the global memory (the GLOBAL_MEMORY dictionary that is part of the _Interpreter _) ï¼Ÿ</li>
</ul>
<p>ç»™å®šä¸‹é¢çš„å° Pascal ç¨‹åºï¼Œç¬¦å·è¡¨å’Œå…¨å±€å†…å­˜çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆGLOBAL_MEMORYå­—å…¸æ˜¯è§£é‡Šå™¨çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Ÿ</p>
<pre><code class="language-pascal">PROGRAM Part11;
VAR
   x, y : INTEGER;
BEGIN
   x := 2;
   y := 3 + x;
END.
</code></pre>
<blockquote>
<p>ç¬¦å·è¡¨</p>
</blockquote>
<table>
<thead>
<tr>
<th>INTEGER</th>
<th>BuiltinTypeSymbol instance</th>
</tr>
</thead>
<tbody>
<tr>
<td>REAL</td>
<td>BuiltinTypeSymbol instance</td>
</tr>
<tr>
<td>x</td>
<td>VarSymbol instance <x : INTEGER></td>
</tr>
<tr>
<td>y</td>
<td>VarSymbol instance <y : INTEGER></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å…¨å±€å†…å­˜</p>
</blockquote>
<table>
<thead>
<tr>
<th>x</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr>
<td>y</td>
<td>5</td>
</tr>
</tbody>
</table>
<blockquote>
<p>GLOBAL_MEMORYå­—å…¸æ˜¯è§£é‡Šå™¨çš„ä¸€éƒ¨åˆ†ã€‚<br>
<img src="https://cdn.nlark.com/yuque/0/2021/png/1773686/1638782458074-e870f858-a7ea-4f49-9776-03a70bd1a474.png" alt="image.png" loading="lazy"></p>
</blockquote>
<p>Thatâ€™s all for today. In the next article, Iâ€™ll talk about scopes and weâ€™ll get our hands dirty with parsing nested procedures. Stay tuned and see you soon! And remember that no matter what, â€œKeepÂ going!â€</p>
<p>ä»Šå¤©å°±åˆ°è¿™é‡Œå§ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®º åŸŸï¼Œå¹¶ä¸”æˆ‘ä»¬å°†äº²è‡ªæ“ä½œè§£æåµŒå¥—è¿‡ç¨‹ã€‚è¯·ç»§ç»­å…³æ³¨ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šå†è§ï¼è®°ä½ï¼Œæ— è®ºå‘ç”Ÿä»€ä¹ˆï¼Œâ€œç»§ç»­å‰è¿›!â€</p>
<blockquote>
<p>get our hands dirty ï¼šå¼„è„æ‰‹ï¼Œæ‰€ä»¥çœŸå®æ„æ€å°±æ˜¯ï¼šäº²è‡ªåŠ¨æ‰‹æ“ä½œã€‚</p>
</blockquote>
<figure data-type="image" tabindex="9"><img src="https://ruslanspivak.com/lsbasi-part11/lsbasi_part11_keep_going.png" alt="" loading="lazy"></figure>
<p>P.S. My explanation of the topic of symbols and symbol table management is heavily influenced by the book <a href="http://amzn.to/2cHsHT1"><em>Language Implementation Patterns</em></a> by Terence Parr. Itâ€™s a terrific book. I think it has the clearest explanation of the topic Iâ€™ve ever seen and it also covers class scopes, a subject that Iâ€™m not going to cover in the series because we will not be discussing object-orientedÂ Pascal.</p>
<p>é™„: æˆ‘å¯¹ç¬¦å·å’Œç¬¦å·è¡¨ç®¡ç†ä¸»é¢˜çš„è§£é‡Šæ·±å— Terence Parr çš„ã€Šè¯­è¨€å®ç°æ¨¡å¼ã€‹ä¸€ä¹¦çš„å½±å“ã€‚è¿™æ˜¯ä¸€æœ¬å¾ˆæ£’çš„ä¹¦ã€‚æˆ‘è®¤ä¸ºå®ƒå¯¹æˆ‘æ‰€è§è¿‡çš„ä¸»é¢˜æœ‰æœ€æ¸…æ™°çš„è§£é‡Šï¼Œå®ƒè¿˜æ¶µç›–äº†classçš„èŒƒå›´ï¼Œè¿™ä¸ªä¸»é¢˜æˆ‘ä¸æ‰“ç®—åœ¨æœ¬ç³»åˆ—ä¸­è®¨è®ºï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šè®¨è®ºé¢å‘å¯¹è±¡çš„ Pascalã€‚</p>
<p>P.P.S.: If you canâ€™t wait and want to start digging into compilers, I highly recommend the freely available classic by Jack Crenshaw <a href="http://compilers.iecc.com/crenshaw/">â€œLetâ€™s Build aÂ Compiler.â€</a></p>
<p>é™„è¨€: å¦‚æœä½ è¿«ä¸åŠå¾…æƒ³å¼€å§‹æŒ–æ˜ç¼–è¯‘å™¨ï¼Œæˆ‘å¼ºçƒˆæ¨è Jack Crenshaw çš„å…è´¹ç»å…¸ä½œå“â€œ Letâ€™s Build a Compilerâ€</p>
<p><strong>All articles in this series:</strong></p>
<p>æœ¬ç³»åˆ—çš„æ‰€æœ‰æ–‡ç« :</p>
<ul>
<li><a href="https://ruslanspivak.com/lsbasi-part1/">Let's Build A Simple Interpreter. Part 1. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part2/">Let's Build A Simple Interpreter. Part 2. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part3/">Let's Build A Simple Interpreter. Part 3. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part4/">Let's Build A Simple Interpreter. Part 4. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part5/">Let's Build A Simple Interpreter. Part 5. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part6/">Let's Build A Simple Interpreter. Part 6. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part7/">Let's Build A Simple Interpreter. Part 7: Abstract Syntax Trees è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬7éƒ¨åˆ†: æŠ½è±¡è¯­æ³•æ ‘</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part8/">Let's Build A Simple Interpreter. Part 8. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part9/">Let's Build A Simple Interpreter. Part 9. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part10/">Let's Build A Simple Interpreter. Part 10. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part11/">Let's Build A Simple Interpreter. Part 11. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part12/">Let's Build A Simple Interpreter. Part 12. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part13/">Let's Build A Simple Interpreter. Part 13: Semantic Analysis è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬13éƒ¨åˆ†: è¯­ä¹‰åˆ†æ</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part14/">Let's Build A Simple Interpreter. Part 14: Nested Scopes and a Source-to-Source Compiler è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬14éƒ¨åˆ†: åµŒå¥—ä½œç”¨åŸŸå’Œæºåˆ°æºç¼–è¯‘å™¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part15/">Let's Build A Simple Interpreter. Part 15. è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬15éƒ¨åˆ†</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part16/">Let's Build A Simple Interpreter. Part 16: Recognizing Procedure Calls è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬16éƒ¨åˆ†: è¯†åˆ«è¿‡ç¨‹è°ƒç”¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part17/">Let's Build A Simple Interpreter. Part 17: Call Stack and Activation Records è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬17éƒ¨åˆ†: è°ƒç”¨å †æ ˆå’Œæ¿€æ´»è®°å½•</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part18/">Let's Build A Simple Interpreter. Part 18: Executing Procedure Calls è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬18éƒ¨åˆ†: æ‰§è¡Œè¿‡ç¨‹è°ƒç”¨</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part19/">Let's Build A Simple Interpreter. Part 19: Nested Procedure Calls è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è§£é‡Šå™¨ã€‚ç¬¬19éƒ¨åˆ†: åµŒå¥—è¿‡ç¨‹è°ƒç”¨</a></li>
</ul>

                        </div>
                        
                            <div class="post-toc">
                                
                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>ztree</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-11/">https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-11/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR ç " target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-11/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-11/&sharesource=qzone&title=[ç¿»è¯‘ä¸å­¦ä¹ ] Let&#39;s Build A Simple Interpreter. Part 11.&pics=https://lzxzl.github.io/images/avatar.png?v=1747748455692&summary="><i class="fa fa-qq"></i></a>
                                                                    <a title="æ–°æµªå¾®åš" target="_blank" href="https://service.weibo.com/share/share.php?url=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-11/&sharesource=weibo&title=[ç¿»è¯‘ä¸å­¦ä¹ ] Let&#39;s Build A Simple Interpreter. Part 11. + " - " + &pic="https://lzxzl.github.io/images/avatar.png?v=1747748455692 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://lzxzl.github.io/tag/GqQg6_YXk/">#
                    ç¼–è¯‘åŸç†
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-12/">
                                                                                            [ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part 12.
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part-10/">
                                                                                                    [ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part 10.
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width: 780px;margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '2a44a295dd16ae7d05b8',
        clientSecret: '8030257bc11446a193cf383767567daca0e26312',
        repo: 'lzxzl.github.io',
        owner: 'lzxzl',
        admin: ['lzxzl'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        ztree
                            
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        ztree &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://lzxzl.github.io/" target="_blank">
                                                ztree
                                            </a>
            </div>
            <div id="update" style="display:none;">
                off
            </div>
            
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
                <script>
                    
                    
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    var newDate = new Date();
                    newDate.setTime(1747748455692);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>