<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    ztree
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://fastly.jsdelivr.net">
<meta name="author" content="ztree">
<meta name="description" content="ç«¹æ–èŠ’é‹è½»èƒœé©¬ï¼Œè°æ€•ï¼Ÿä¸€è“‘çƒŸé›¨ä»»å¹³ç”Ÿã€‚">
<meta name="keywords" content="Binary">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://lzxzl.github.io/styles/main.css" />
<link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
    
            <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                        <!--CDNæ ·å¼-->
                        <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://lzxzl.github.io">
                    ztree
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        å½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        å…³äº
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1747748455692" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://lzxzl.github.io">
                            ztree
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1747748455692" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            å½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            å…³äº
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                [ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part6.
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            ztree
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2021-11-11</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">12.7
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">2456</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://lzxzl.github.io/tag/GqQg6_YXk/">ç¼–è¯‘åŸç†</a>
                                
                            </span>
                                            
                                                é˜…è¯»é‡:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                        <div class="post-content">
                            <p>Today is <em>the</em> day ğŸ˜ƒ â€œWhy?â€ you might ask. The reason is that today weâ€™re wrapping up our discussion of arithmetic expressions (well, almost) by adding parenthesized expressions to our grammar and implementing an interpreter that will be able to evaluate parenthesized expressions with arbitrarily deep nesting, like the expression 7 + 3 * (10 / (12 / (3 + 1) -Â 1)).</p>
<p>ä»Šå¤©å°±æ˜¯è¿™ä¸ªæ—¥å­:)â€œä¸ºä»€ä¹ˆ?â€ä½ å¯èƒ½ä¼šé—®ã€‚åŸå› æ˜¯ï¼Œä»Šå¤©æˆ‘ä»¬ç»“æŸäº†å¯¹ç®—æœ¯è¡¨è¾¾å¼(å—¯ï¼Œå‡ ä¹)çš„è®¨è®ºï¼Œæˆ‘ä»¬åœ¨grammarä¸­æ·»åŠ äº†æ‹¬å·è¡¨è¾¾å¼ï¼Œå¹¶å®ç°äº†ä¸€ä¸ªè§£é‡Šå™¨ï¼Œå®ƒå¯ä»¥ç”¨ä»»æ„æ·±åº¦çš„åµŒå¥—å¯¹æ‹¬å·è¡¨è¾¾å¼æ±‚å€¼ï¼Œæ¯”å¦‚è¡¨è¾¾å¼7 + 3 * (10/(12/(3 + 1)-1))ã€‚</p>
<p>Letâ€™s get started, shallÂ we?</p>
<p>æˆ‘ä»¬å¼€å§‹å§ï¼Ÿ</p>
<p>First, letâ€™s modify the grammar to support expressions inside parentheses. As you remember from <a href="http://ruslanspivak.com/lsbasi-part5/">Part 5</a>, the <em>factor</em> rule is used for basic units in expressions. In that article, the only basic unit we had was an integer. Today weâ€™re adding another basic unit - a parenthesized expression. Letâ€™s doÂ it.</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¿®æ”¹grammarä»¥æ”¯æŒæ‹¬å·å†…çš„è¡¨è¾¾å¼ã€‚æ­£å¦‚ä½ åœ¨ç¬¬5éƒ¨åˆ†ä¸­æ‰€è®°å¾—çš„ï¼Œfactor è§„åˆ™ç”¨äºè¡¨è¾¾å¼ä¸­çš„åŸºæœ¬å•ä½ã€‚åœ¨é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å”¯ä¸€çš„åŸºæœ¬å•ä½æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚ä»Šå¤©æˆ‘ä»¬è¦æ·»åŠ å¦ä¸€ä¸ªåŸºæœ¬å•å…ƒâ€”â€”æ‹¬å·è¡¨è¾¾å¼ã€‚æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<p>Here is our updatedÂ grammar:</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬æœ€æ–°çš„grammar:</p>
<figure data-type="image" tabindex="1"><img src="https://ruslanspivak.com/lsbasi-part6/lsbasi_part6_grammar.png" alt="" loading="lazy"></figure>
<p>The <em>expr</em> and the <em>term</em> productions are exactly the same as in <a href="http://ruslanspivak.com/lsbasi-part5/">Part 5</a> and the only change is in the <em>factor</em> production where the terminal LPAREN represents a left parenthesis â€˜(â€˜, the terminal RPAREN represents a right parenthesis â€˜)â€™, and the non-terminal <em>expr</em> between the parentheses refers to the <em>expr</em>Â rule.</p>
<p>Expr å’Œ term  ä¸¤ä¸ªäº§ç”Ÿå¼ä¸ç¬¬5éƒ¨åˆ†ä¸­çš„å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€çš„å˜åŒ–æ˜¯factor äº§ç”Ÿå¼ï¼Œå…¶ä¸­ç»ˆç»“ç¬¦ LPAREN è¡¨ç¤ºå·¦æ‹¬å·â€œ(â€ï¼Œç»ˆç»“ç¬¦ RPAREN è¡¨ç¤ºå³æ‹¬å·â€˜)â€™ï¼Œæ‹¬å·ä¹‹é—´çš„éç»ˆç»“ç¬¦ expr è¡¨ç¤º expr äº§ç”Ÿå¼ã€‚</p>
<p>Here is the updated syntax diagram for the <em>factor</em>, which now includesÂ alternatives:</p>
<p>ä¸‹é¢æ˜¯æ›´æ–°åçš„factorçš„syntaxå›¾ï¼Œç°åœ¨åŒ…å«äº†å…¶ä»–é€‰é¡¹:</p>
<figure data-type="image" tabindex="2"><img src="https://ruslanspivak.com/lsbasi-part6/lsbasi_part6_factor_diagram.png" alt="" loading="lazy"></figure>
<p>Because the grammar rules for the <em>expr</em> and the <em>term</em> havenâ€™t changed, their syntax diagrams look the same as in <a href="http://ruslanspivak.com/lsbasi-part5/">Part 5</a>:</p>
<p>å› ä¸º expr å’Œ term çš„grammarè§„åˆ™æ²¡æœ‰æ”¹å˜ï¼Œå®ƒä»¬çš„syntaxå›¾çœ‹èµ·æ¥å’Œç¬¬5éƒ¨åˆ†ä¸€æ ·:</p>
<figure data-type="image" tabindex="3"><img src="https://ruslanspivak.com/lsbasi-part6/lsbasi_part6_expr_term_diagram.png" alt="" loading="lazy"></figure>
<p>Here is an interesting feature of our new grammar - it is recursive. If you try to derive the expression 2 * (7 + 3), you will start with the <em>expr</em> start symbol and eventually you will get to a point where you will recursively use the <em>expr</em> rule again to derive the (7 + 3) portion of the original arithmeticÂ expression.</p>
<p>è¿™æ˜¯æˆ‘ä»¬æ–°grammarçš„ä¸€ä¸ªæœ‰è¶£çš„ç‰¹ç‚¹â€”â€”å®ƒæ˜¯é€’å½’çš„ã€‚å¦‚æœæ‚¨å°è¯•æ´¾ç”Ÿè¡¨è¾¾å¼2 * (7 + 3) ï¼Œé‚£ä¹ˆæ‚¨å°†ä» expr èµ·å§‹ç¬¦å·å¼€å§‹ï¼Œæœ€ç»ˆæ‚¨å°†åˆ°è¾¾ä¸€ä¸ªç‚¹ï¼Œä¼šå†æ¬¡é€’å½’åœ°ä½¿ç”¨ expr è§„åˆ™æ´¾ç”ŸåŸå§‹ç®—æœ¯è¡¨è¾¾å¼çš„(7 + 3)éƒ¨åˆ†ã€‚</p>
<p>Letâ€™s decompose the expression 2 * (7 + 3) according to the grammar and see how itÂ looks:</p>
<p>è®©æˆ‘ä»¬æ ¹æ®grammaråˆ†è§£è¡¨è¾¾å¼2 * (7 + 3) ï¼Œçœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ ·çš„:</p>
<figure data-type="image" tabindex="4"><img src="https://ruslanspivak.com/lsbasi-part6/lsbasi_part6_decomposition.png" alt="" loading="lazy"></figure>
<p>A little aside: if you need a refresher on recursion, take a look at Daniel P. Friedman and Matthias Felleisenâ€™s <a href="http://www.amazon.com/gp/product/0262560992/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0262560992&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=IM7CT7RLWNGJ7J54">The Little Schemer</a> book - itâ€™s reallyÂ good.</p>
<p>é¡ºä¾¿è¯´ä¸€å¥: å¦‚æœä½ éœ€è¦å¤ä¹ ä¸€ä¸‹é€’å½’ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹Daniel P. Friedmanå’Œ Matthias Felleisen çš„ã€Š<a href="http://www.amazon.com/gp/product/0262560992/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0262560992&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=IM7CT7RLWNGJ7J54">The Little Schemer</a>ã€‹-è¿™æœ¬ä¹¦çœŸçš„å¾ˆä¸é”™ã€‚</p>
<p>Okay, letâ€™s get moving and translate our new updated grammar toÂ code.</p>
<p>å¥½äº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼ŒæŠŠæ–°æ›´æ–°çš„grammarç¿»è¯‘æˆä»£ç ã€‚</p>
<p>The following are the main changes to the code from the previousÂ article:</p>
<p>ä»¥ä¸‹æ˜¯å¯¹ä¸Šä¸€ç¯‡æ–‡ç« ä»£ç çš„ä¸»è¦ä¿®æ”¹:</p>
<ol>
<li>The <em>Lexer</em> has been modified to return two more tokens: LPAREN for a left parenthesis and RPAREN for a right parenthesis.
<ul>
<li>å¯¹Lexerè¿›è¡Œäº†ä¿®æ”¹ï¼Œä»¥è¿”å›å¦å¤–ä¸¤ä¸ªæ ‡è®°:LPAREN(å·¦æ‹¬å·)å’ŒRPAREN(å³æ‹¬å·)ã€‚</li>
</ul>
</li>
<li>The <em>Interpreter</em>â€˜s <em>factor</em> method has been slightly updated to parse parenthesized expressions in addition to integers.
<ul>
<li>è§£é‡Šå™¨çš„factoræ–¹æ³•ç•¥æœ‰æ›´æ–°ï¼Œé™¤äº†è§£ææ•´æ•°å¤–ï¼Œè¿˜å¯ä»¥è§£æåœ†æ‹¬å·è¡¨è¾¾å¼ã€‚</li>
</ul>
</li>
</ol>
<p>Here is the complete code of a calculator that can evaluate arithmetic expressions containing integers; any number of addition, subtraction, multiplication and division operators; and parenthesized expressions with arbitrarily deepÂ nesting:</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªè®¡ç®—å™¨çš„å®Œæ•´ä»£ç ï¼Œå®ƒå¯ä»¥è®¡ç®—åŒ…å«æ•´æ•°çš„ç®—æœ¯è¡¨è¾¾å¼; ä»»æ„æ•°é‡çš„åŠ ã€å‡ã€ä¹˜ã€é™¤è¿ç®—ç¬¦; ä»¥åŠä»»æ„æ·±åº¦åµŒå¥—çš„æ‹¬å·è¡¨è¾¾å¼:</p>
<pre><code class="language-python"># Token types
#
# EOF (end-of-file) token is used to indicate that
# there is no more input left for lexical analysis
INTEGER, PLUS, MINUS, MUL, DIV, LPAREN, RPAREN, EOF = (
    'INTEGER', 'PLUS', 'MINUS', 'MUL', 'DIV', '(', ')', 'EOF'
)


class Token(object):
    def __init__(self, type, value):
        self.type = type
        self.value = value

    def __str__(self):
        &quot;&quot;&quot;String representation of the class instance.

        Examples:
            Token(INTEGER, 3)
            Token(PLUS, '+')
            Token(MUL, '*')
        &quot;&quot;&quot;
        return 'Token({type}, {value})'.format(
            type=self.type,
            value=repr(self.value)
        )

    def __repr__(self):
        return self.__str__()


class Lexer(object):
    def __init__(self, text):
        # client string input, e.g. &quot;4 + 2 * 3 - 6 / 2&quot;
        self.text = text
        # self.pos is an index into self.text
        self.pos = 0
        self.current_char = self.text[self.pos]

    def error(self):
        raise Exception('Invalid character')

    def advance(self):
        &quot;&quot;&quot;Advance the `pos` pointer and set the `current_char` variable.&quot;&quot;&quot;
        self.pos += 1
        if self.pos &gt; len(self.text) - 1:
            self.current_char = None  # Indicates end of input
        else:
            self.current_char = self.text[self.pos]

    def skip_whitespace(self):
        while self.current_char is not None and self.current_char.isspace():
            self.advance()

    def integer(self):
        &quot;&quot;&quot;Return a (multidigit) integer consumed from the input.&quot;&quot;&quot;
        result = ''
        while self.current_char is not None and self.current_char.isdigit():
            result += self.current_char
            self.advance()
        return int(result)

    def get_next_token(self):
        &quot;&quot;&quot;Lexical analyzer (also known as scanner or tokenizer)

        This method is responsible for breaking a sentence
        apart into tokens. One token at a time.
        &quot;&quot;&quot;
        while self.current_char is not None:

            if self.current_char.isspace():
                self.skip_whitespace()
                continue

            if self.current_char.isdigit():
                return Token(INTEGER, self.integer())

            if self.current_char == '+':
                self.advance()
                return Token(PLUS, '+')

            if self.current_char == '-':
                self.advance()
                return Token(MINUS, '-')

            if self.current_char == '*':
                self.advance()
                return Token(MUL, '*')

            if self.current_char == '/':
                self.advance()
                return Token(DIV, '/')

            if self.current_char == '(':
                self.advance()
                return Token(LPAREN, '(')

            if self.current_char == ')':
                self.advance()
                return Token(RPAREN, ')')

            self.error()

        return Token(EOF, None)


class Interpreter(object):
    def __init__(self, lexer):
        self.lexer = lexer
        # set current token to the first token taken from the input
        self.current_token = self.lexer.get_next_token()

    def error(self):
        raise Exception('Invalid syntax')

    def eat(self, token_type):
        # compare the current token type with the passed token
        # type and if they match then &quot;eat&quot; the current token
        # and assign the next token to the self.current_token,
        # otherwise raise an exception.
        if self.current_token.type == token_type:
            self.current_token = self.lexer.get_next_token()
        else:
            self.error()

    def factor(self):
        &quot;&quot;&quot;factor : INTEGER | LPAREN expr RPAREN&quot;&quot;&quot;
        token = self.current_token
        if token.type == INTEGER:
            self.eat(INTEGER)
            return token.value
        elif token.type == LPAREN:
            self.eat(LPAREN)
            result = self.expr()
            self.eat(RPAREN)
            return result

    def term(self):
        &quot;&quot;&quot;term : factor ((MUL | DIV) factor)*&quot;&quot;&quot;
        result = self.factor()

        while self.current_token.type in (MUL, DIV):
            token = self.current_token
            if token.type == MUL:
                self.eat(MUL)
                result = result * self.factor()
            elif token.type == DIV:
                self.eat(DIV)
                result = result // self.factor()

        return result

    def expr(self):
        &quot;&quot;&quot;Arithmetic expression parser / interpreter.

        calc&gt; 7 + 3 * (10 / (12 / (3 + 1) - 1))
        22

        expr   : term ((PLUS | MINUS) term)*
        term   : factor ((MUL | DIV) factor)*
        factor : INTEGER | LPAREN expr RPAREN
        &quot;&quot;&quot;
        result = self.term()

        while self.current_token.type in (PLUS, MINUS):
            token = self.current_token
            if token.type == PLUS:
                self.eat(PLUS)
                result = result + self.term()
            elif token.type == MINUS:
                self.eat(MINUS)
                result = result - self.term()

        return result


def main():
    while True:
        try:
            text = input('calc&gt; ')
        except EOFError:
            break
        if not text:
            continue
        lexer = Lexer(text)
        interpreter = Interpreter(lexer)
        result = interpreter.expr()
        print(result)


if __name__ == '__main__':
    main()

</code></pre>
<p>Save the above code into the <a href="https://github.com/rspivak/lsbasi/blob/master/part6/calc6.py">calc6.py</a> file, try it out and see for yourself that your new interpreter properly evaluates arithmetic expressions that have different operators andÂ parentheses.</p>
<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜åˆ° calc6.py æ–‡ä»¶ä¸­ï¼Œå°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹ä½ çš„æ–°è§£é‡Šå™¨èƒ½å¦æ­£ç¡®åœ°è®¡ç®—å…·æœ‰ä¸åŒè¿ç®—ç¬¦å’Œæ‹¬å·çš„ç®—æœ¯è¡¨è¾¾å¼ã€‚</p>
<p>Here is a sampleÂ session:</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:</p>
<pre><code class="language-python">$ python calc6.py
calc&gt; 3
3
calc&gt; 2 + 7 * 4
30
calc&gt; 7 - 8 / 4
5
calc&gt; 14 + 2 * 3 - 6 / 2
17
calc&gt; 7 + 3 * (10 / (12 / (3 + 1) - 1))
22
calc&gt; 7 + 3 * (10 / (12 / (3 + 1) - 1)) / (2 + 3) - 5 - 3 + (8)
10
calc&gt; 7 + (((3 + 2)))
12
</code></pre>
<p>And here is a new exercise for you forÂ today:</p>
<p>ä¸‹é¢æ˜¯ä»Šå¤©çš„ä¸€ä¸ªæ–°ç»ƒä¹ :</p>
<figure data-type="image" tabindex="5"><img src="https://ruslanspivak.com/lsbasi-part6/lsbasi_part6_exercises.png" alt="" loading="lazy"></figure>
<ul>
<li>Write your own version of the interpreter of arithmetic expressions as described in this article. Remember: repetition is the mother of allÂ learning.
<ul>
<li>å¦‚æœ¬æ–‡æ‰€è¿°ï¼Œç¼–å†™ä½ è‡ªå·±ç‰ˆæœ¬çš„ç®—æœ¯è¡¨è¾¾å¼è§£é‡Šå™¨ã€‚è®°ä½: é‡å¤æ˜¯å­¦ä¹ ä¹‹æ¯ã€‚</li>
</ul>
</li>
</ul>
<p>Hey, you read all the way to the end! Congratulations, youâ€™ve just learned how to create (and if youâ€™ve done the exercise - youâ€™ve actually written) a basic <em>recursive-descent parser / interpreter</em> that can evaluate pretty complex arithmeticÂ expressions.</p>
<p>å˜¿ï¼Œä½ ä»å¤´è¯»åˆ°å°¾äº†ï¼æ­å–œä½ ï¼Œä½ åˆšåˆšå­¦ä¼šäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„é€’å½’ä¸‹é™è§£æå™¨/è§£é‡Šå™¨(å¦‚æœä½ å·²ç»å®Œæˆäº†è¿™ä¸ªç»ƒä¹ çš„è¯â€”â€”ä½ å®é™…ä¸Šå·²ç»ç¼–å†™äº†) ï¼Œå®ƒå¯ä»¥è®¡ç®—éå¸¸å¤æ‚çš„ç®—æœ¯è¡¨è¾¾å¼ã€‚</p>
<p>In the next article I will talk in a lot more detail about <em>recursive-descent parsers</em>. I will also introduce an important and widely used data structure in interpreter and compiler construction that weâ€™ll use throughout theÂ series.</p>
<p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ›´è¯¦ç»†åœ°è®¨è®ºé€’å½’ä¸‹é™è§£æå™¨ã€‚æˆ‘è¿˜å°†ä»‹ç»ä¸€ç§åœ¨è§£é‡Šå™¨å’Œç¼–è¯‘å™¨æ„é€ ä¸­å¹¿æ³›ä½¿ç”¨çš„é‡è¦æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å°†åœ¨æ•´ä¸ªç³»åˆ—ä¸­ä½¿ç”¨è¿™ç§ç»“æ„ã€‚</p>
<p>Stay tuned and see you soon. Until then, keep working on your interpreter and most importantly: have fun and enjoy theÂ process!</p>
<p>è¯·ç»§ç»­å…³æ³¨ï¼Œå›å¤´è§ã€‚åœ¨é‚£ä¹‹å‰ï¼Œç»§ç»­ä¸ºä½ çš„è§£é‡Šå™¨å·¥ä½œï¼Œæœ€é‡è¦çš„æ˜¯: äº«å—è¿™ä¸ªè¿‡ç¨‹ï¼</p>
<p>Here is a list of books I recommend that will help you in your study of interpreters andÂ compilers:</p>
<p>ä¸‹é¢æ˜¯æˆ‘æ¨èçš„ä¸€äº›ä¹¦ç±ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ å­¦ä¹ è§£é‡Šå™¨å’Œç¼–è¯‘å™¨:</p>
<ol>
<li><a href="http://www.amazon.com/gp/product/193435645X/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=193435645X&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=MP4DCXDV6DJMEJBL">Language Implementation Patterns: Create Your Own Domain-Specific and General Programming Languages (Pragmatic Programmers)</a><br>
è¯­è¨€å®ç°æ¨¡å¼: åˆ›å»ºæ‚¨è‡ªå·±çš„ç‰¹å®šé¢†åŸŸå’Œé€šç”¨ç¼–ç¨‹è¯­è¨€(å®ç”¨ç¨‹åºå‘˜)</li>
<li><a href="http://www.amazon.com/gp/product/0470177071/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0470177071&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=UCLGQTPIYSWYKRRM">Writing Compilers and Interpreters: A Software Engineering Approach</a><br>
ç¼–å†™ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨: ä¸€ç§è½¯ä»¶å·¥ç¨‹æ–¹æ³•</li>
<li><a href="http://www.amazon.com/gp/product/052182060X/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=052182060X&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=ZSKKZMV7YWR22NMW">Modern Compiler Implementation in Java</a><br>
ç°ä»£ç¼–è¯‘å™¨åœ¨ Java ä¸­çš„å®ç°</li>
<li><a href="http://www.amazon.com/gp/product/1461446988/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1461446988&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=PAXWJP5WCPZ7RKRD">Modern Compiler Design</a><br>
ç°ä»£ç¼–è¯‘å™¨è®¾è®¡</li>
<li><a href="http://www.amazon.com/gp/product/0321486811/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321486811&amp;linkCode=as2&amp;tag=russblo0b-20&amp;linkId=GOEGDQG4HIHU56FQ">Compilers: Principles, Techniques, and Tools (2nd Edition)</a><br>
ç¼–è¯‘å™¨: åŸç†ã€æŠ€æœ¯å’Œå·¥å…·(ç¬¬äºŒç‰ˆ)</li>
</ol>
<p><strong>All articles in this series:</strong></p>
<ul>
<li><a href="https://ruslanspivak.com/lsbasi-part1/">Let's Build A Simple Interpreter. Part 1.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part2/">Let's Build A Simple Interpreter. Part 2.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part3/">Let's Build A Simple Interpreter. Part 3.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part4/">Let's Build A Simple Interpreter. Part 4.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part5/">Let's Build A Simple Interpreter. Part 5.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part6/">Let's Build A Simple Interpreter. Part 6.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part7/">Let's Build A Simple Interpreter. Part 7: Abstract Syntax Trees</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part8/">Let's Build A Simple Interpreter. Part 8.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part9/">Let's Build A Simple Interpreter. Part 9.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part10/">Let's Build A Simple Interpreter. Part 10.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part11/">Let's Build A Simple Interpreter. Part 11.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part12/">Let's Build A Simple Interpreter. Part 12.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part13/">Let's Build A Simple Interpreter. Part 13: Semantic Analysis</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part14/">Let's Build A Simple Interpreter. Part 14: Nested Scopes and a Source-to-Source Compiler</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part15/">Let's Build A Simple Interpreter. Part 15.</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part16/">Let's Build A Simple Interpreter. Part 16: Recognizing Procedure Calls</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part17/">Let's Build A Simple Interpreter. Part 17: Call Stack and Activation Records</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part18/">Let's Build A Simple Interpreter. Part 18: Executing Procedure Calls</a></li>
<li><a href="https://ruslanspivak.com/lsbasi-part19/">Let's Build A Simple Interpreter. Part 19: Nested Procedure Calls</a></li>
</ul>

                        </div>
                        
                            <div class="post-toc">
                                
                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>ztree</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part6/">https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part6/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR ç " target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part6/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part6/&sharesource=qzone&title=[ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part6.&pics=https://lzxzl.github.io/images/avatar.png?v=1747748455692&summary="><i class="fa fa-qq"></i></a>
                                                                    <a title="æ–°æµªå¾®åš" target="_blank" href="https://service.weibo.com/share/share.php?url=https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part6/&sharesource=weibo&title=[ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part6. + " - " + &pic="https://lzxzl.github.io/images/avatar.png?v=1747748455692 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://lzxzl.github.io/tag/GqQg6_YXk/">#
                    ç¼–è¯‘åŸç†
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://lzxzl.github.io/post/lets-build-a-simple-interpreter-part6-java-ban-ben/">
                                                                                            Letâ€™s Build A Simple Interpreter. Part6. â€”â€” Javaç‰ˆæœ¬
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://lzxzl.github.io/post/fan-yi-yu-xue-xi-lets-build-a-simple-interpreter-part5/">
                                                                                                    [ç¿»è¯‘ä¸å­¦ä¹ ] Letâ€™s Build A Simple Interpreter. Part5.
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width: 780px;margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '2a44a295dd16ae7d05b8',
        clientSecret: '8030257bc11446a193cf383767567daca0e26312',
        repo: 'lzxzl.github.io',
        owner: 'lzxzl',
        admin: ['lzxzl'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        ztree
                            
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        ztree &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://lzxzl.github.io/" target="_blank">
                                                ztree
                                            </a>
            </div>
            <div id="update" style="display:none;">
                off
            </div>
            
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
                <script>
                    
                    
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    var newDate = new Date();
                    newDate.setTime(1747748455692);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>